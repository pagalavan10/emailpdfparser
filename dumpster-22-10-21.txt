
/*============================================================================================================
*Class Name     : DumpstersTriggerHandler
*Description    : All the implementations related to Dumpsters object should be handled here
*Company        : Merfantz Technologies Pvt Ltd
*Date           : 7th Sept, 2018
*Version        : 1.0
*Change History : DumpstersTriggerHandler
*Methods        : public void OnAfterInsert(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap)
public void OnAfterUpdate(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap)
public void Containerfieldupdate(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap)
public void CycleCompleteStatus(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap)
public void contanerAssetAdditional(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap)
public void dumpsterCreationsInUseAt(Map<Id,Dumpsters__c> newdumMap)
public void DumpsterValidationCheck(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap)
*============================================================================================================*/

/*------------------------------------------------------------------------------------------------------------
Method Name: DumpstersTriggerHandler(newdumMap,olddmMap)
-------------------------------------------------------------------------------------------------------------*/

public class DumpstersTriggerHandler{
    Public List<String> Zipcode;
    Public Integer count;
    Public String trimmedZip;
    
    public void OnBeforeInsert(List<Dumpsters__c> newDumplist){
        Dropoff(newDumplist);
         Pickup(newDumplist);
        ValidateAddressZip(newDumplist);
        checkAustinHelperInsert(newDumpList);
        CheckHoustonHelperInsert(newDumpList);
      //  update_ConcreteonlyComments(newDumplist); // Commented on 17/8/21 - WF has the Logic
        duplicatecheckinsPurchaseorder(newDumplist);
        replacecomments(newDumplist);
        comments_replace(newDumplist);
        
        ValidateDriver(newDumplist);
        
        
       // udpatedriverlookup(newDumplist);
        
    }
    public void OnBeforeUpdate(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumpMap) {
        Dropoff(newdumMap.Values());
        Pickup(newdumMap.Values());
        ValidateAddressZip(newdumMap.Values());
        CheckAustinHelper(newdumMap,olddumpMap);
        CheckHoustonHelper(newdumMap,olddumpMap);
        duplicatecheckPurchaseorder(newdumMap);
        
        //  ValidateDriver(newdumMap.Values());
      //  udpatedriverlookup(newdumMap.Values());
        
        Map<Id, Dumpsters__c> DumpsterMap = new Map<Id, Dumpsters__c>();
        List<Dumpsters__c>Cardrunlist = new List<Dumpsters__c>();
        List<Dumpsters__c> FilteredCommentsMap = new List<Dumpsters__c>();
        
        for(Dumpsters__c DumpsterFor : newdumMap.values())
        {
            if(DumpsterFor.Pick_Up_Driver__c != olddumpMap.get(DumpsterFor.Id).Pick_Up_Driver__c && DumpsterFor.Container_Asset__c != null)
            {
                DumpsterMap.put(DumpsterFor.Id, DumpsterFor);
            }
            if(DumpsterFor.Comments__c != olddumpMap.get(DumpsterFor.Id).Comments__c && DumpsterFor.Comments__c != null)
            {
                FilteredCommentsMap.add(DumpsterFor);
            }
            
            if(!(DumpsterFor.Card_run__c != olddumpMap.get(DumpsterFor.Id).Card_run__c))
            {
                Cardrunlist.add(DumpsterFor);                     
            }
            
            
        }
        
        if(DumpsterMap.size()>0)
        {
            system.debug('Inside Validation check for Equipment');
            Equipment_Assert_Validation(DumpsterMap);
        }
        
        if(FilteredCommentsMap.size()>0)
        {
            system.debug('Inside Validation check for Equipment');
            comments_replace(FilteredCommentsMap);
        }
        
        
        if(Cardrunlist .size()>0)
        {
            system.debug('Inside Validation check for Cardrun');
            ValidateDriver(Cardrunlist );
        }
        
        
    }
    public void OnAfterInsert(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){ 
        Map<Id, Dumpsters__c> InsertingDumpMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> CloneDumpMap = new Map<Id, Dumpsters__c>();
        Set<ID> DumpIDSet = new Set<ID>();
        
        DumpsterValidationCheck(newdumMap,olddumMap);
        dumpsterCreationsInUseAt(newdumMap);
        FinalInvoiceCardRunUpdates(newdumMap,olddumMap);     //17284
        createExpenses(newdumMap);
        ChargeUpdates(newdumMap,olddumMap); //charge updates deactivated as per the customer request 'https://merfantz.freshdesk.com/a/tickets/12189'
        
        for(Dumpsters__c dump : newDumMap.values()){
            
            if(dump.Confirmed_Pick_Up_Date__c != null || dump.Drop_Off_Visit_Date__c != null){
                InsertingDumpMap.put(dump.id,dump);
            } 
            if(dump.Pdf_Parser_Delivery_Address__c != null){
                DumpIDSet.add(dump.id);
            }     
            if(dump.Is_Cloning__c )
            {
                CloneDumpMap.put(dump.id,dump);
            }
        }
        if(InsertingDumpMap.size() > 0){
            DumpsterRecordAlert(InsertingDumpMap);
            FifteenDumpsterRecordAlert(InsertingDumpMap);
            
            
            if(DumpIDSet.size() > 0){
                UpdateGeoCodes(DumpIDSet);
            }
        }
        
        
        if(CloneDumpMap.size()>0)
        {
            updateCloneDumpsterComments(CloneDumpMap);
        }
    }  
    /*------------------------------------------------------------------------------------------------------------
Method Name: OnBeforeDelete(newMap)
-------------------------------------------------------------------------------------------------------------*/
    
    public void OnBeforeDelete(Map<Id,Dumpsters__c> OlddumMap){  
        Map<id,Dumpsters__c> WithoutTestAcc= New Map<id,Dumpsters__c>();
        for(Dumpsters__c Dump : OlddumMap.values())
        {
            if(!Dump.test_Dumpster__c)
            {
                WithoutTestAcc.put(Dump.id,Dump);
            }
        }
        if(WithoutTestAcc.size()>0)
            sendDeleteNotification(WithoutTestAcc);
        
    }
    /*------------------------------------------------------------------------------------------------------------
Method Name: OnAfterUpdate(newdumMap,olddmMap)
-------------------------------------------------------------------------------------------------------------*/
    
    public void OnAfterUpdate(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){  
        Map<Id, Dumpsters__c> UpdatingDumpMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> Filtered_Weekly_Invoice_Map = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> UpdateDumpMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> invCommentupdateMap= new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> DumpsterInvoiceDelete = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> MoreUpdateDumpMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> AverageCycleDaysMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> DumpsterInterimInvoice = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> CycleCompleteStatusMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> NewDumpster = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> FilteredPickupNewDumpster = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> FilteredPickupNewDumpsterInvoice = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> relocationCommentRevertMap= new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> DropoffNewDumpsterMap= new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> statusPickUpSchldMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpsters__c> invoiceupdateMap = new Map<Id, Dumpsters__c>();
        Map<Id, Pickup_schedule_New_Dumpster__c> PickupNewDumpster = new Map<Id, Pickup_schedule_New_Dumpster__c>();
        Map<Id, Dumpsters__c> Filtered_Trip_SMS = new Map<Id, Dumpsters__c>();
        Trip_SMS__c Trip_SMS = Trip_SMS__c.getInstance();
        system.debug(Trip_SMS.Active__c);
        
        Set<ID> DumpIDSet = new Set<ID>();
        
        
        
        If(!TrggrUtility.RunOnceD) {
            
            DumpsterValidationCheck(newdumMap,olddumMap);    // 12408 -Avoided the duplicate method call 
            UpdateCardrun(newdumMap,olddumMap);
            FinalInvoiceCardRunUpdates(newdumMap,olddumMap);   //17284
            //CycleCompleteStatus(newdumMap,olddumMap);    
            Containerfieldupdate(newdumMap,olddumMap);
            contanerAssetAdditional(newdumMap,olddumMap);
            contanerAssetAdditionals(newdumMap,olddumMap);
            //SalesTaxUpdate(newdumMap,olddumMap);
            
            Map<String, Pickup_schedule_New_Dumpster__c> Pickupschedule = new Map<String, Pickup_schedule_New_Dumpster__c>();
            Pickupschedule = Pickup_schedule_New_Dumpster__c.getAll();
            system.debug('Pickup_schedule_New_Dumpster__c.getAll()'+Pickupschedule );
            for(Pickup_schedule_New_Dumpster__c Pickup_schedule_New_Dumpster_For : Pickup_schedule_New_Dumpster__c.getAll().values())
            {
                if(Pickup_schedule_New_Dumpster_For.Active__c)
                    PickupNewDumpster.put(Pickup_schedule_New_Dumpster_For.Account_Id__c, Pickup_schedule_New_Dumpster_For);
            }
            
            for(DUmpsters__c dump : newDumMap.values()){
                if((olddumMap.get(dump.id).Confirmed_Pick_Up_Date__c != dump.Confirmed_Pick_Up_Date__c && dump.Confirmed_Pick_Up_Date__c != null ) ||(olddumMap.get(dump.id).Drop_Off_Visit_Date__c != dump.Drop_Off_Visit_Date__c && dump.Drop_Off_Visit_Date__c != null)){
                    UpdatingDumpMap.put(dump.id,dump);
                }
                if((olddumMap.get(dump.id).Confirmed_Pick_Up_Date__c != dump.Confirmed_Pick_Up_Date__c && dump.Confirmed_Pick_Up_Date__c != null ) && dump.Status__c == 'Request for Pick-Up'){
                    UpdateDumpMap.put(dump.id,dump);
                }
                
                if((((dump.Interim_Invoices__c!= olddumMap.get(dump.id).Interim_Invoices__c)) && dump.Interim_Invoices__c == 'Create' )) //53357
                    // if((((dump.Status__c != olddumMap.get(dump.id).Status__c)) && dump.Status__c == 'Pick-Up Scheduled' && dump.Interim_Invoice__c &&(!((dump.Interim_Invoices__c!= olddumMap.get(dump.id).Interim_Invoices__c)) && dump.Interim_Invoices__c == 'Create' )) || (((dump.Interim_Invoices__c!= olddumMap.get(dump.id).Interim_Invoices__c)) && dump.Interim_Invoices__c == 'Create' )) //53357 //((dump.Status__c != olddumMap.get(dump.id).Status__c)) && dump.Status__c == 'Pick-Up Scheduled' && dump.Interim_Invoice__c       //&& dump.Final_invoice_count__c == 1 
                {
                    system.debug('Inside Interim Invoice');
                    DumpsterInterimInvoice.put(dump.id, dump);
                }
                
                if(((dump.Full_At_The_Office__c != olddumMap.get(dump.id).Full_At_The_Office__c && dump.Full_At_The_Office__c == 'Yes') || (dump.Status__c != olddumMap.get(dump.id).Status__c && dump.Status__c == 'Pick-Up Scheduled' && !dump.Full_at_Office_Dumpster_Cloned__c )) && PickupNewDumpster.containskey(dump.AAccountccount__c))
                {
                    FilteredPickupNewDumpster.put(dump.Id, dump);
                }
                if(dump.status__c != olddumMap.get(dump.id).status__c && (dump.Status__c == 'Drop Off Complete' || dump.Status__c == 'Pick-Up Scheduled') && Trip_SMS.Active__c)
                {
                    Filtered_Trip_SMS.put(dump.Id, dump);
                }
                
                if(dump.Invoicing_Comments_Final__c!= olddumMap.get(dump.id).Invoicing_Comments_Final__c && dump.Invoicing_Comments_Final__c !=null) //58817
                {
                    invCommentupdateMap.put(dump.Id, dump);
                }
                
                if(dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Drop Off Complete' && dump.AAccountccount__c==Label.Liberty_Demolition )
                {
                    DropoffNewDumpsterMap.put(dump.Id, dump);
                }
                
                
                /*
if(dump.Trip_Order__c != olddumMap.get(dump.id).Trip_Order__c && (dump.Drop_Off_Visit_Date__c == system.TODAY() || dump.Confirmed_Pick_Up_Date__c == system.TODAY() ))
{
newDumpIDSet.add(dump.id);
oldDumpIDSet.add(olddumMap.id); 
}
*/
                
                /*
if(dump.Status__c != olddumMap.get(dump.id).Status__c && dump.Status__c == 'Pick-Up Scheduled' && ((dump.Consolidate_Invoice__c == 'Yes' && dump.Consolidate_Invoice_Count__c >= 1) || dump.Final_Invoice_Count__c >= 1 ) && !dump.Interim_Invoice__c && dump.Weekly_Consolidate_Invoice__c != 'Yes')
{
system.debug('Inside New Dumpster Invoice');
FilteredPickupNewDumpsterInvoice.put(dump.Id, dump);
}*/
                
                if((dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Drop Off Complete' && dump.AAccountccount__c==Label.HAJ_WDS_Account_Id) && (dump.Pdf_Parser_Delivery_Address__c.containsignorecase(Label.HAJ_WDS_Account_Address) || dump.Pdf_Parser_Delivery_Address__c == null))
                {
                    NewDumpster.put(dump.id, dump); 
                } 
                
                //relocationCommentRevert
                if((dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c != 'Relocation' ) || ( dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c != 'Request for Pick-Up') || (dump.Confirmed_Pick_Up_Date__c!= olddumMap.get(dump.id).Confirmed_Pick_Up_Date__c && dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c != 'Drop Off Complete') ) //|| (dump.Confirmed_Pick_Up_Date__c!= olddumMap.get(dump.id).Confirmed_Pick_Up_Date__c && dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Request for Pick-Up')//&& (dump.Status__c == 'Drop Off Complete' || dump.Status__c == 'Request for Pick-Up')
                {
                    system.debug('Inside relocation ');
                    relocationCommentRevertMap.put(dump.id, dump); 
                } 
                
                if(dump.Confirmed_Pick_Up_Date__c != null && olddumMap.get(dump.id).Confirmed_Pick_Up_Date__c != dump.Confirmed_Pick_Up_Date__c) //61785
                {
                    AverageCycleDaysMap.put(dump.id,dump);
                    system.debug('aveerage cycle days mapp added');
                }
                
            }
            if(UpdatingDumpMap.size() > 0){
                DumpsterRecordAlert(UpdatingDumpMap);
            }
            if(UpdateDumpMap.size() > 0){
                FifteenDumpsterRecordAlert(UpdateDumpMap);
            }
            if(DumpsterInterimInvoice.size()>0)
            {
                create_interim_invoice(DumpsterInterimInvoice);
            }
            if(FilteredPickupNewDumpster.size()>0)
            {
                createnewdumpsterafterpickup(FilteredPickupNewDumpster);
            }
            if(Filtered_Trip_SMS.size() > 0)
            {
                update_trip_SMS(Filtered_Trip_SMS, olddumMap);
            }
            
            if(NewDumpster.size()>0)
            {
                create_new_dumpster(NewDumpster);
            }   
            
            if(relocationCommentRevertMap.size()>0)
            {
                relocationCommentRevert(relocationCommentRevertMap,olddumMap);
            }
            
            if(invCommentupdateMap.size()>0)  //58817
            {
                InvoicecommentUpdate(invCommentupdateMap);
            } 
            
            if(DropoffNewDumpsterMap.size()>0) //62217
            {
                createnewdumpsterafterdropoff(DropoffNewDumpsterMap);
            }   
            
            if(AverageCycleDaysMap.size()>0) //61785
            {
                
                updateAverageCycleDays(AverageCycleDaysMap);
                system.debug('aveerage cycle days method called');
                
            }
           
            
            /*if(FilteredPickupNewDumpsterInvoice.size() > 0)
{
createnewdumpsterinvoice(FilteredPickupNewDumpsterInvoice);
}
InvoiceCreation(newdumMap,olddumMap);
InvoiceUpdates(newdumMap,olddumMap);
*/        
            
            TrggrUtility.RunOnceD = true;
            
            /*if(MoreUpdateDumpMap.size()>0)
{
request_Pickup_More_Dumpster(MoreUpdateDumpMap);
}*/
            
            
        }
        for(DUmpsters__c dump : newDumMap.values())
        {               
            // To update Average Cycle days in account from the Dumpster            
            
            if(dump.Status__c == 'Request for Pick-Up' && olddumMap.get(dump.id).Status__c != dump.Status__c && dump.Comments__c != null && dump.Comments__c != '')
            {
                MoreUpdateDumpMap.put(dump.id,dump);
            }
            if((olddumMap.get(dump.id).Pdf_Parser_Delivery_Address__c != dump.Pdf_Parser_Delivery_Address__c) ){
                system.debug('<<115>>');
                DumpIDSet.add(dump.id);
            }
            
            if(dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Cycle Complete' && dump.Final_Invoice_Number__c != olddumMap.get(dump.id).Final_Invoice_Number__c && dump.Final_Invoice_Number__c == 0)
            {
                DumpsterInvoiceDelete.put(dump.id,dump);
            }
            
            /*
if((dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Drop Off Complete' && dump.AAccountccount__c==Label.HAJ_WDS_Account_Id) && (dump.Pdf_Parser_Delivery_Address__c.containsignorecase(Label.HAJ_WDS_Account_Address) || dump.Pdf_Parser_Delivery_Address__c == null))
{
NewDumpster.put(dump.id, dump); 
}
*/ 
            
            if(dump.Consolidate_Invoice__c == 'Yes' && dump.Weekly_Consolidate_Invoice__c == 'Yes')
            {
                if(dump.Status__c == 'Pick-Up Scheduled' && (olddummap.get(dump.id).Status__c != dump.Status__c || olddummap.get(dump.id).Dumpster_Size__c != dump.Dumpster_Size__c || olddummap.get(dump.id).AAccountccount__c!= dump.AAccountccount__c || olddummap.get(dump.id).Per_Ton_Charge__c != dump.Per_Ton_Charge__c || olddummap.get(dump.id).Dumpster_Rental_price__c != dump.Dumpster_Rental_price__c || olddummap.get(dump.id).Initial_Invoice_Subtotal__c != dump.Initial_Invoice_Subtotal__c || olddummap.get(dump.id).Other_Charges__c != dump.Other_Charges__c || olddummap.get(dump.id).Wait_Charge__c != dump.Wait_Charge__c || olddummap.get(dump.id).Extra_Rental_Charge_Per_Day__c != dump.Extra_Rental_Charge_Per_Day__c || olddummap.get(dump.id).Final_Invoice_Subtotal__c != dump.Final_Invoice_Subtotal__c || olddummap.get(dump.id).Tonnage_Quantity__c != dump.Tonnage_Quantity__c || olddummap.get(dump.id).Additional_Tonnage_Quantity__c != dump.Additional_Tonnage_Quantity__c || olddummap.get(dump.id).Confirmed_Pick_Up_Date__c != dump.Confirmed_Pick_Up_Date__c || olddummap.get(dump.id).X10_Days_Rental_Up_Date__c != dump.X10_Days_Rental_Up_Date__c || olddummap.get(dump.id).Sales_tax__c != dump.Sales_tax__c || olddummap.get(dump.id).Prohibited_Items__c != dump.Prohibited_Items__c || olddummap.get(dump.id).Card_Run__c != dump.Card_Run__c))
                {
                    Filtered_Weekly_Invoice_Map.put(dump.id, dump);
                }
                
            }
            
            if(dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Cycle Complete')
            {
                system.debug('InsideCyclecomplete');
                CycleCompleteStatusMap.put(dump.id, dump);
            }
            
            if(dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c == 'Pick-Up Scheduled')
            {
                statusPickUpSchldMap.put(dump.id,dump); 
            }
            
            
            if(dump.Rental__c=='Dumpster Rental' && dump.AAccountccount__r.Consolidated_Invoice__c != 'Yes' && (olddummap.get(dump.id).Dumpster_Size__c != dump.Dumpster_Size__c || olddummap.get(dump.id).AAccountccount__c!= dump.AAccountccount__c || olddummap.get(dump.id).Concrete_Only__c != dump.Concrete_Only__c || olddummap.get(dump.id).Haulbrooke_Regional_Base__c  != dump.Haulbrooke_Regional_Base__c || olddummap.get(dump.id).Per_Ton_Charge__c != dump.Per_Ton_Charge__c || olddummap.get(dump.id).Dumpster_Rental_price__c != dump.Dumpster_Rental_price__c || olddummap.get(dump.id).Initial_Invoice_Subtotal__c != dump.Initial_Invoice_Subtotal__c || olddummap.get(dump.id).Other_Charges__c != dump.Other_Charges__c || olddummap.get(dump.id).Wait_Charge__c != dump.Wait_Charge__c || olddummap.get(dump.id).Extra_Rental_Charge_Per_Day__c != dump.Extra_Rental_Charge_Per_Day__c || olddummap.get(dump.id).Final_Invoice_Subtotal__c != dump.Final_Invoice_Subtotal__c || olddummap.get(dump.id).Tonnage_Quantity__c != dump.Tonnage_Quantity__c || olddummap.get(dump.id).Additional_Tonnage_Quantity__c != dump.Additional_Tonnage_Quantity__c || olddummap.get(dump.id).Confirmed_Pick_Up_Date__c != dump.Confirmed_Pick_Up_Date__c || olddummap.get(dump.id).X10_Days_Rental_Up_Date__c != dump.X10_Days_Rental_Up_Date__c || olddummap.get(dump.id).Sales_tax__c != dump.Sales_tax__c || olddummap.get(dump.id).Prohibited_Items__c != dump.Prohibited_Items__c || olddummap.get(dump.id).Card_Run__c != dump.Card_Run__c))
            {
                invoiceupdateMap.put(dump.id,dump);
            }
            
            /*
if((dump.status__c != olddumMap.get(dump.id).status__c && dump.Status__c != 'Relocation') || dump.status__c != olddumMap.get(dump.id).status__c && (dump.Status__c != 'Drop Off Complete' || dump.Status__c != 'Request for Pick-Up')  ) //&& (dump.Status__c == 'Drop Off Complete' || dump.Status__c == 'Request for Pick-Up')
{
relocationCommentRevertMap.put(dump.id, dump); 
} 
*/
            
        }
        /*
if(relocationCommentRevertMap.size()>0)
{
relocationCommentRevert(relocationCommentRevertMap);
}
*/
       
        
        if(MoreUpdateDumpMap.size()>0)
        {
            request_Pickup_More_Dumpster(MoreUpdateDumpMap);
        }
        
        if(DumpIDSet.size() > 0){
            UpdateGeoCodes(DumpIDSet);
        }
        
        if(DumpsterInvoiceDelete.size() > 0)
        {
            deleteDumpsterInvoice(DumpsterInvoiceDelete);
        }
        if(CycleCompleteStatusMap.size() > 0)
        {
            CycleCompleteStatus(CycleCompleteStatusMap, olddumMap);
        }
        
        /*
if(NewDumpster.size()>0)
{
create_new_dumpster(NewDumpster);
}  
*/ 
        if(statusPickUpSchldMap.size()>0)
        {
            statusPickUpScheduledMap(statusPickUpSchldMap,olddumMap);
        }
        //CycleCompleteStatus(newdumMap,olddumMap);    

        
        InvoiceCreation(newdumMap,olddumMap);
        if(invoiceupdateMap.size()>0)
        {
            system.debug('InvoiceUpdates>>');
            
            InvoiceUpdates(invoiceupdateMap,olddumMap);
        }
        
        if(Filtered_Weekly_Invoice_Map.size()>0)
        {
            weekly_Consolidate_Invoice(Filtered_Weekly_Invoice_Map, olddumMap);
        }
        
    }
    
    
    /*=====================Ticket 48546===============================
*Method Name     : sendDeleteNotification
*Description     : Sending email notification when delete Dumpster
====================================================*/
    public static void sendDeleteNotification(Map<id,Dumpsters__c> OldDumpMap){
        system.debug('OldDumpMap====================================='+OldDumpMap);
        Messaging.SingleEmailMessage[] messages = new List<Messaging.SingleEmailMessage>();
        List<Messaging.SingleEmailMessage> mails = 
            new List<Messaging.SingleEmailMessage>();
        for(Dumpsters__c Dump :OldDumpMap.Values()){
            string[] toadd = new string[] {Label.Delete_Notification_Email};
                EmailTemplate emailTemplate = [Select Id,Subject,Description,HtmlValue,DeveloperName,Body from EmailTemplate where name ='Dumpster Deletion Template' limit 1];
            Messaging.SingleEmailMessage mail = new Messaging.SingleEmailMessage();
            mail.toAddresses=toadd;
            mail.setReplyTo('no-reply@haulbrooke.com');
            mail.setSenderDisplayName('Haulbrooke Support');
            mail.setSubject(Messaging.renderStoredEmailTemplate(emailTemplate.Id,UserInfo.getUserId(), Dump.Id).getSubject());
            mail.setHtmlBody(Messaging.renderStoredEmailTemplate(emailTemplate.Id,UserInfo.getUserId(), Dump.Id).getHtmlBody());
            mails.add(mail); 
            
        }
        if(mails.size()>0){
            Messaging.sendEmail(mails);
        }
    }
    /*=================Ticket No : 44901===================================
*Method Name     : ValidateAddressZip
*Description     : Every dumpster record that is added, must be entered with a zip code. 
*Arguments       : Dumpster newList
====================================================*/
    
    public static void ValidateAddressZip(List<Dumpsters__c> newdump){
        
        for(Dumpsters__c Dump : newdump){
            system.debug('===================================='+Dump.Pdf_Parser_Delivery_Address__c);
            if(!Dump.test_Dumpster__c)
            {
                if(Dump.Pdf_Parser_Delivery_Address__c!=null){
                    Map<String,String> bAdd = addressParser.parseAddress(Dump.Pdf_Parser_Delivery_Address__c);
                    String PostalCode=null;
                    if(bAdd.Containskey('Postal Code'))
                        system.debug('111>>');
                    PostalCode = bAdd.get('Postal Code');
                    system.debug('PostalCode>>> '+PostalCode);
                    if(PostalCode!=null){
                        system.debug('22>>');
                        if(!PostalCode.startsWith('7')){
                            system.debug('33>>');
                            Dump.addError('Please Enter the Valid Zip Code');
                        }
                    } else{
                        system.debug('44>>');
                        Dump.addError('Please Enter the Valid Zip Code'); 
                    } 
                }else{
                    system.debug('===5455================================='+Dump.Pdf_Parser_Delivery_Address__c);
                    
                    Dump.addError('Please Enter the Valid Zip Code'); 
                }
            } 
        }
        
    }
    /*=================Ticket No : 44735===================================
*Method Name     : ValidateDriver
*Description     : We have a delivery / pickup at this same address, are you sure you want different drivers?
*Arguments       : Dumpster newList
====================================================*/
    
    public static void udpatedriverlookup(List<Dumpsters__c> newdump){
        Map<string,id> Resources = new Map<string,id>();
        for(Resource__c rece:[select id, Full_name__c from Resource__c])
        {
            resources.put(rece.full_name__c,rece.id);
        }
        
        
        for(Dumpsters__c Dump : newdump){
            if(Dump.Driver__c !=null){
                if(resources.containskey(Dump.Driver__c))
                    Dump.Drop_of_Driver_Lkp__c = resources.get(Dump.Driver__c);
                else
                    Dump.Drop_of_Driver_Lkp__c = null;
                
            }
            if(Dump.Pick_Up_Driver__c !=null){
                if(resources.containskey(Dump.Pick_Up_Driver__c))
                    Dump.Pick_Up_Driver_Lkp__c = resources.get(Dump.Pick_Up_Driver__c );
                else
                    Dump.Pick_Up_Driver_Lkp__c = null;
            }
        }
    }
    
    
    public static void ValidateDriver(List<Dumpsters__c> newdump){
        List<date> DateList = new List<date>();
        for(Dumpsters__c Dump : newdump){
            if(Dump.Status__c =='Unscheduled'){
                DateList.add(Dump.Drop_Off_Visit_Date__c);
            }
        }
        for(Dumpsters__c DumpReq : [Select id, Drop_Off_Visit_Date__c, Status__c,Confirmed_Pick_Up_Date__c, Pick_Up_Driver__c, Pdf_Parser_Delivery_Address__c  from Dumpsters__c  where Confirmed_Pick_Up_Date__c=:DateList]){
                                        for(Dumpsters__c Dump : newdump){
                                            if(Dump.Pdf_Parser_Delivery_Address__c!=null && DumpReq.Pdf_Parser_Delivery_Address__c!=null)
                                            {
                                                String DumpReqAdd = DumpReq.Pdf_Parser_Delivery_Address__c.replaceAll('\r\n|\\.|,|\n|\r|\\s+','').Trim();
                                                String DumpAdd =Dump.Pdf_Parser_Delivery_Address__c.replaceAll('\r\n|,|\\.|\n|\r|\\s+','').Trim();          
                                                System.debug('DumpReqAdd--'+DumpReqAdd);
                                                System.debug('DumpAdd--'+DumpAdd);
                                                
                                                if(Dump.Status__c =='Unscheduled' && DumpReq.Status__c == 'Request for Pick-Up' && Dump.DifferentDriverSameAddress__c==false && Dump.Id != DumpReq.id && DumpReq.Pick_Up_Driver__c != Dump.Driver__c  && DumpReq.Confirmed_Pick_Up_Date__c == Dump.Drop_Off_Visit_Date__c && DumpReqAdd == DumpAdd ){
                                                       System.debug('DumpReq.Pick_Up_Driver__c---'+DumpReq.Pick_Up_Driver__c);                                                   
                                                       System.debug('Dump.Driver__c--'+Dump.Driver__c);
                                                       System.debug('Dump.Pdf_Parser_Delivery_Address__c--'+DumpAdd);
                                                       System.debug('DumpReq.Pdf_Parser_Delivery_Address__c--'+DumpReqAdd);
                                                       
                                                       Dump.addError(Label.DriverValidation); 
                                                   }
                                            }
                                        }
                                    }
    }
    /*=================Ticket No : 12561===================================
*Method Name     : UpdateCardRun
*Description     : Whenever CardRun field is updated the related dumpster Invoice CardRun also updated
*Arguments       : Dumpster newMap,OldMap
====================================================*/
    
    
    public static void UpdateCardRun(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){
        List<id> DumpsterIdList = new List<id>();
        Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();
        List<Dumpster_Invoice__c> DumpsterInvoiceList = new List<Dumpster_Invoice__c>();
        
        Dumpster_Invoice__c DumpInv;
        for(Dumpsters__c dumpster:newdumMap.values()){
            if(!dumpster.Interim_Invoice__c)
                DumpstersMap.put(dumpster.id,dumpster);
        }
        system.debug('value are------------------------>'+dumpstersMap);
        
        for(Dumpster_Invoice__c DumInvoice : [SELECT Id, Card_Run__c,Dumpsters__c,Dumpsters__r.Card_Run__c FROM Dumpster_Invoice__c where Dumpsters__c=:DumpstersMap.keyset() ]){
            if(DumpstersMap.get(DumInvoice.Dumpsters__c).Card_Run__c!=DumInvoice.Card_Run__c ){
                DumpInv = new Dumpster_Invoice__c(); 
                DumpInv.id=DumInvoice.id;
                DumpInv.Card_run__c = DumpstersMap.get(DumInvoice.Dumpsters__c).Card_Run__c;
                DumpsterInvoiceList.add(DumpInv);
            }
        }
        try{
            update DumpsterInvoiceList;
        }catch(exception e){
            system.debug('Exception raised due to --------------------------->'+e);
        }
    }
    
    
    /*------------------------------------------------------------------------------------------------------------
Method Name: Containerfieldupdate(newdumMap,olddmMap)
-------------------------------------------------------------------------------------------------------------*/
    
    public void Containerfieldupdate(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){
        try{
            List<Container_Assets__c> UpdateContainer=new List<Container_Assets__c>();
            Map<string,string> updateInuse=new Map<string,string>();
            for(Dumpsters__c d:newdumMap.values()){
                if(d.Container_Asset__c!=null && d.Container_Asset__c!=olddumMap.get(d.id).Container_Asset__c){
                    updateInuse.put(d.Container_Asset__c,d.id);
                }
                if(olddumMap.get(d.id).Container_Asset__c!=null && d.Container_Asset__c!=olddumMap.get(d.id).Container_Asset__c && olddumMap.get(d.id).Container_Asset__c!=d.Container_Asset_Additional__c && olddumMap.get(d.id).Container_Asset__c!=d.Container_Asset_Additionals__c){
                    updateInuse.put(olddumMap.get(d.id).Container_Asset__c,null);
                }
            }      
            system.debug('---11-----'+updateInuse);
            for(Container_Assets__c ca:[select id,In_Use_At__c from Container_Assets__c where id IN:updateInuse.keyset()]){
                
                ca.In_Use_At__c=updateInuse.get(ca.id);
                UpdateContainer.add(ca);
            }
            system.debug('---11-----'+UpdateContainer);
            if(UpdateContainer.size()>0){
                update UpdateContainer;
            }
        }catch(exception e){
            system.debug('error'+e);
        }
    }
    
    /*------------------------------------------------------------------------------------------------------------
Method Name: CycleCompleteStatus(newdumMap,olddmMap)
-------------------------------------------------------------------------------------------------------------*/
    
    public void CycleCompleteStatus(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){
        system.debug('Came>>>111');
        try{
            system.debug('Came>>>222');
            List<string> constring=new List<string>();
            List<string> dupsid=new List<string>(); 
            List<Dumpsters__c>updatedum=new List<Dumpsters__c>(); 
            for(Dumpsters__c d:newdumMap.values()){
                if(d.Status__c!=olddumMap.get(d.id).Status__c && d.Status__c=='Cycle Complete'){      
                    constring.add(d.Container_Asset__c);
                    constring.add(d.Container_Asset_Additional__c);
                    constring.add(d.Container_Asset_Additionals__c);
                    dupsid.add(d.id);
                }     
            }
            
            List<Container_Assets__c>containerlist=[SELECT Id,Permanent_Location__c,In_Use_At__c FROM Container_Assets__c where id IN:constring];
            
            List<Container_Assets__c>updatenull=new List<Container_Assets__c>();
            for(Container_Assets__c co:containerlist){
                co.In_Use_At__c=null;      
                updatenull.add(co);
            }
            
            if(updatenull.size()>0){
                update updatenull;
            }  
            for(Dumpsters__c dm:[select id,name,Container_Asset__c,Container_Asset_Additional__c,Container_Asset_Additionals__c from Dumpsters__c where id=:dupsid]){
                if(dm.Container_Asset__c!=null){
                    dm.Container_Asset__c=null;
                }
                if(dm.Container_Asset_Additional__c!=null){
                    dm.Container_Asset_Additional__c=null;
                }
                if(dm.Container_Asset_Additionals__c!=null){
                    dm.Container_Asset_Additionals__c=null;
                }
                updatedum.add(dm);  
            }
            if(updatedum.size()>0){
                system.debug('Came>>>333');
                update updatedum;
            }
            
        }catch(exception e){
            system.debug('error'+e);
        }        
    }   
    /*------------------------------------------------------------------------------------------------
Method Name: contanerAssetAdditional();
Description: If you choose container Asset that related container asset In Use At field autopopulate
-------------------------------------------------------------------------------------------------*/
    public void contanerAssetAdditional(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){
        /*try{
List<String>conid=new List<String>();
List<Container_Assets__c> UpdateContainer=new List<Container_Assets__c>();
Map<string,string> updateInuse=new Map<string,string>();
for(Dumpsters__c d:newdumMap.values()){
if(d.Container_Asset_Additional__c!=null && d.Container_Asset_Additional__c!=olddumMap.get(d.id).Container_Asset_Additional__c ){
updateInuse.put(d.Container_Asset_Additional__c,d.id);
}
if(olddumMap.get(d.id).Container_Asset_Additional__c!=null && olddumMap.get(d.id).Container_Asset_Additional__c!=d.Container_Asset__c && olddumMap.get(d.id).Container_Asset_Additional__c!=d.Container_Asset_Additionals__c && d.Container_Asset_Additional__c!=olddumMap.get(d.id).Container_Asset_Additional__c ){
updateInuse.put(olddumMap.get(d.id).Container_Asset_Additional__c,null);
}
}      
for(Container_Assets__c ca:[select id,In_Use_At__c from Container_Assets__c where id IN:updateInuse.keyset()]){

ca.In_Use_At__c=updateInuse.get(ca.id);
UpdateContainer.add(ca);
}
system.debug('---11-----'+UpdateContainer);
if(UpdateContainer.size()>0){
update UpdateContainer;
}
}catch(exception e){
system.debug('error'+e);
} */
    }
    /*---------------------------------------------------------------------------------------------------------
Method Name: contanerAssetAdditionals();
Description: If you choose container Asset that related container asset In Use At field autopopulate
----------------------------------------------------------------------------------------------------------*/
    public void contanerAssetAdditionals(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap){
        /*try{
List<String>conid=new List<String>();
List<Container_Assets__c> UpdateContainer=new List<Container_Assets__c>();
Map<string,string> updateInuse=new Map<string,string>();
for(Dumpsters__c d:newdumMap.values()){
if(d.Container_Asset_Additionals__c!=null && d.Container_Asset_Additionals__c!=olddumMap.get(d.id).Container_Asset_Additionals__c ){
updateInuse.put(d.Container_Asset_Additionals__c,d.id);
}
if(olddumMap.get(d.id).Container_Asset_Additionals__c!=null && d.Container_Asset_Additionals__c!=olddumMap.get(d.id).Container_Asset_Additionals__c && olddumMap.get(d.id).Container_Asset_Additionals__c!=d.Container_Asset__c && olddumMap.get(d.id).Container_Asset_Additionals__c!=d.Container_Asset_Additional__c ){
updateInuse.put(olddumMap.get(d.id).Container_Asset_Additionals__c,null);
}
}      
for(Container_Assets__c ca:[select id,In_Use_At__c from Container_Assets__c where id IN:updateInuse.keyset()]){

ca.In_Use_At__c=updateInuse.get(ca.id);
UpdateContainer.add(ca);
}

if(UpdateContainer.size()>0){
update UpdateContainer;
}


}catch(exception e){
system.debug('error'+e);
}  */
    }
    
    /*
    public void update_ConcreteonlyComments(List<Dumpsters__c> newMap)
    {
        for(Dumpsters__c Dumpsterfor : newmap)
        {
            DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace(Label.Concrete_Only_Pickup_Comments_All, '');
            DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace(Label.Concrete_Only_Pickup_Comments_Houston, '');
            DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace(Label.Concrete_Only_Pickup_Comments_Austin, ''); //61099
            
            if(Dumpsterfor.Is_Cloning__c && Dumpsterfor.Comments__c != null && !Dumpsterfor.Comments__c.containsignorecase('Should be concrete only,') && Dumpsterfor.Fill_Details__c == 'Concrete Only')
            {
                String AccountId = Dumpsterfor.AAccountccount__c;
                AccountId = AccountId.substring(0,AccountId.length()-3);
                if(Label.Concrete_Only_Comments_change.contains(AccountId))
                {
                    DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace('Pick Up Instructions:', 'Pick Up Instructions:\n'+ Label.Concrete_Only_Pickup_Comments);
                    DumpsterFor.Pickup_Instructions_Helper__c = Label.Concrete_Only_Pickup_Comments;
                }
                else
                {
                    system.debug(DumpsterFor.Haulbrooke_Regional_Base__c);
                    if(DumpsterFor.Haulbrooke_Regional_Base__c == 'San Antonio')
                    {    
                        if(DumpsterFor.Austin_Checkbox_Helper__c ) //61099
                        {
                            DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace('Pick Up Instructions:', 'Pick Up Instructions:\n'+ Label.Concrete_Only_Pickup_Comments_Austin);
                            DumpsterFor.Pickup_Instructions_Helper__c = Label.Concrete_Only_Pickup_Comments_Austin;
                        }
                        else
                        {
                            DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace('Pick Up Instructions:', 'Pick Up Instructions:\n'+ Label.Concrete_Only_Pickup_Comments_All);
                            DumpsterFor.Pickup_Instructions_Helper__c = Label.Concrete_Only_Pickup_Comments_All;
                        }
                    }
                    else
                    {
                        DumpsterFor.Comments__c = DumpsterFor.Comments__c.replace('Pick Up Instructions:', 'Pick Up Instructions:\n'+ Label.Concrete_Only_Pickup_Comments_Houston);
                        DumpsterFor.Pickup_Instructions_Helper__c = Label.Concrete_Only_Pickup_Comments_Houston;
                    }
                }
            }
        }
    }
    */
    /*------------------------------------------------------------------------------------------------------------
Method Name: dumpsterCreationsInUseAt()
-------------------------------------------------------------------------------------------------------------*/
    public void dumpsterCreationsInUseAt(Map<Id,Dumpsters__c> newdumMap){
        try{  
            String dumid;
            List<Container_Assets__c> updateCA=new List<Container_Assets__c>(); 
            List<string>CAid=new List<string>();
            for(Dumpsters__c dm:newdumMap.values()){
                dumid=dm.id;
                if(dm.Container_Asset__c!=null){
                    CAid.add(dm.Container_Asset__c);                    
                }
                if(dm.Container_Asset_Additional__c!=null){
                    CAid.add(dm.Container_Asset_Additional__c);                    
                }
                if(dm.Container_Asset_Additionals__c!=null){
                    CAid.add(dm.Container_Asset_Additionals__c);                    
                }
            }   
            for(Container_Assets__c ca:[select id,In_Use_At__c from Container_Assets__c where id IN:CAid]){
                ca.In_Use_At__c=dumid;
                updateCA.add(ca);
            }
            if(updateCA.size()>0){
                update updateCA;
            } 
        }catch(exception e){
            system.debug('Error'+e);
        }
    }
    
    public void replacecomments(List<Dumpsters__c> newMap)
    {
        for(Dumpsters__c Dumpsterfor : newMap)
        {
            if(Dumpsterfor.Fill_Details__c != 'Cardboard/Plastic Only')
            {
                if(Dumpsterfor.Comments__c != null)
                    Dumpsterfor.Comments__c = Dumpsterfor.Comments__c.replace(Label.Cardboard_Only_Pickup_Comments,'');
                if(Dumpsterfor.Invoicing_Comments__c != null)
                    Dumpsterfor.Invoicing_Comments__c = Dumpsterfor.Invoicing_Comments__c.replace(Label.Cardboard_Only_Invoicing_Comments,'');
            }
        }
    }
    
    /*-----------------------------------------------------------------------------------------
Method Name: statuspickUpScheduledMap()
Amended    : 22-Jun-2018
-------------------------------------------------------------------------------------------*/
    public void statusPickUpScheduledMap(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap){
        try{
            List<String>dumpsterid=new List<String>(); 
            List<Dumpsters__c>UpdateDumpsters=new List<Dumpsters__c>();
            List<string>ContainerAssetid=new List<string>();
            List<Container_Assets__c> updateCA=new List<Container_Assets__c>();
            for(Dumpsters__c dum:newdumMap.values()){
                if(dum.status__C=='Pick-up Scheduled' && dum.status__C!=olddumMap.get(dum.id).status__c){
                    dumpsterid.add(dum.id);
                    ContainerAssetid.add(dum.Container_Asset__c);
                    ContainerAssetid.add(dum.Container_Asset_Additional__c);
                    ContainerAssetid.add(dum.Container_Asset_Additionals__c);
                }
            }
            for(Dumpsters__c d:[select id,name,Container_Asset__c,Container_Asset_Additional__c,Container_Asset_Additionals__c from Dumpsters__c where  id IN:dumpsterid]){   
                if(d.Container_Asset__c!=null){
                    d.Container_Asset__c=null;
                }
                if(d.Container_Asset_Additional__c!=null){
                    d.Container_Asset_Additional__c=null;
                }
                if(d.Container_Asset_Additionals__c!=null){
                    d.Container_Asset_Additionals__c=null;
                }
                UpdateDumpsters.add(d);
            }
            if(UpdateDumpsters.size()>0){
                update UpdateDumpsters;
            }
            for(Container_Assets__c ca:[select id,name,In_Use_At__c from Container_Assets__c where id IN:ContainerAssetid]){
                ca.In_Use_At__c=null;
                updateCA.add(ca);
            }
            if(updateCA.size()>0){
                update updateCA;
            }   
        }catch(Exception e){
            system.debug('Error'+e);
        }
    }
    public void createExpenses(Map<Id,Dumpsters__c> newdumMap){
        try{
            List<Dumpster_Expense__c>dumexpenses=Dumpster_Expense__c.getAll().values();
            Milestone1_Expense__c exp;
            List<Milestone1_Expense__c>explist=new List<Milestone1_Expense__c>(); 
            for(Dumpsters__c dum:newdumMap.values()){
                if(dum.Rental__c != 'Dumpster Rental'){
                    for(Dumpster_Expense__c dexp:dumexpenses){
                        exp= new Milestone1_Expense__c();
                        exp.Vendor__c=dexp.Vendor__c;
                        exp.Description__c=dexp.Description__c;
                        exp.Project__c=dexp.Project__c;
                        exp.Originator__c=dexp.Originator__c;
                        exp.Date_Incurred__c=system.today();
                        exp.Dumpsters__c=dum.id;
                        explist.add(exp);
                    }
                }
            } 
            if(explist.size()>0){
                insert explist;
            } 
        }catch(exception e){
            system.debug('Error'+e);
        }   
    }
    
    /*-----------------------------------------------------------------------------------------
Method Name: DumpsterValidationCheck(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap)
Amended    : 6-Sept-2018
-------------------------------------------------------------------------------------------*/
    public void DumpsterValidationCheck(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap){
        List<id> dumpsterid = new List<id>(); 
        boolean flag=false; //flags determines which field need to be add Error
        boolean flag1=false;
        boolean flag2=false;
        
        List<id> ContainerAssetId = new List<id>();
        Map<id,Container_Assets__c> ContainerAssetMap=new Map<id,Container_Assets__c>();
        
        for(Dumpsters__c dum:newdumMap.values()){
            if(TrggrUtility.ContainerAssetExistCheck){
                system.debug(newdumMap.get(dum.id).Container_Asset__c);
                System.debug('<<<<New Map>>>>>'+newdumMap);
                System.debug('<<<<Old Map>>>>>'+olddumMap);
                
                //if(!newdumMap.get(dum.id).iscloned__c){
                if((olddumMap==null && dum.Container_Asset__c!=null) || (olddumMap!=null && dum.Container_Asset__c!=olddumMap.get(dum.id).Container_Asset__c && dum.Container_Asset__c!=null)){
                    flag=true;
                    ContainerAssetId.add(dum.Container_Asset__c);
                }
                if((olddumMap==null && dum.Container_Asset_Additional__c!=null) || olddumMap!=null && dum.Container_Asset_Additional__c!=olddumMap.get(dum.id).Container_Asset_Additional__c && dum.Container_Asset_Additional__c!=null){
                    flag1=true;
                    ContainerAssetId.add(dum.Container_Asset_Additional__c);
                }
                if((olddumMap==null && dum.Container_Asset_Additionals__c!=null) || olddumMap!=null && dum.Container_Asset_Additionals__c!=olddumMap.get(dum.id).Container_Asset_Additionals__c && dum.Container_Asset_Additionals__c!=null){
                    flag2=true;
                    ContainerAssetId.add(dum.Container_Asset_Additionals__c);
                }
                //   }
            }
        }
        
        System.debug('<<<Container assert >>>'+[select id,In_Use_At__c from Container_Assets__c where id=:ContainerAssetId and In_Use_At__c!=null]);
        for(Container_Assets__c ContAsset:[select id,In_Use_At__c from Container_Assets__c where id=:ContainerAssetId and In_Use_At__c!=null]){
            ContainerAssetMap.put(ContAsset.id,ContAsset);
        }
        
        for(Dumpsters__c dumPlistchk1:newdumMap.values()){
            
            if(ContainerAssetMap.containskey(dumPlistchk1.Container_Asset__c)  && flag){
                dumPlistchk1.Container_Asset__c.addError('Kindly Choose Different Container Asset');
            }
            if(ContainerAssetMap.containskey(dumPlistchk1.Container_Asset_Additional__c) && flag1){
                dumPlistchk1.Container_Asset_Additional__c.addError('Kindly Choose Different Container Asset');
            }
            if(ContainerAssetMap.containskey(dumPlistchk1.Container_Asset_Additionals__c) && flag2){
                dumPlistchk1.Container_Asset_Additionals__c.addError('Kindly Choose Different Container Asset');
            }
            
        }
        
    }
    
    public void Equipment_Assert_Validation(Map<Id,Dumpsters__c> newdumMap)
    {
        Set<Id> DumpsterId = new Set<Id>();
        Set<Id> Equipment_Assert_Id = new Set<Id>();
        Set<String> Driver_Name_short = new Set<String>();
        Set<String> Driver_Name_000 = new Set<String>();
        
        for(Dumpsters__c DumpsterFor : newdumMap.values())
        {
            DumpsterId.add(DumpsterFor.Id);
        }
        system.debug('DumpsterId >>'+DumpsterId);
        
        for(Equipment_Asset_Validation__c Equipment_Asset_Validation_For : [Select id, Name, Active__c, Equipment_Id__c from Equipment_Asset_Validation__c where Active__c = true])
        {
            Equipment_Assert_Id.add(Equipment_Asset_Validation_For.Equipment_Id__c);
            system.debug('Equipment_Assert_Id >>'+Equipment_Assert_Id);
        }
        system.debug('Equipment_Assert_Id >>'+Equipment_Assert_Id);  
        for(Equipment_Assets__c Equipment_Assets_For : [Select id, Today_s_Driver__c, Second_Shirt_Driver__c, Dumpster_Check__c from Equipment_Assets__c where id =: Equipment_Assert_Id])
        {
            system.debug('checking point'+Equipment_Assert_Id);
            if(Equipment_Assets_For.Dumpster_Check__c == 'Short')
            {
                system.debug('Dumpster_Check__c');
                if(Equipment_Assets_For.Today_s_Driver__c != null)
                    Driver_Name_short.add(Equipment_Assets_For.Today_s_Driver__c);
                if(Equipment_Assets_For.Second_Shirt_Driver__c != null)
                    Driver_Name_short.add(Equipment_Assets_For.Second_Shirt_Driver__c);
            }
            if(Equipment_Assets_For.Dumpster_Check__c == '000 - 014')
            {
                if(Equipment_Assets_For.Today_s_Driver__c != null)
                    Driver_Name_000.add(Equipment_Assets_For.Today_s_Driver__c);
                if(Equipment_Assets_For.Second_Shirt_Driver__c != null)
                    Driver_Name_000.add(Equipment_Assets_For.Second_Shirt_Driver__c);
            }
        }
        system.debug(Driver_Name_short);
        system.debug('Driver_Name_short.size()<<<<>>>>'+Driver_Name_short.size());
        system.debug('Driver_Name_000.size()<<<<>>>>'+Driver_Name_000.size());
        if(Driver_Name_short.size()>0 && Driver_Name_000.size() > 0)
        {                
            for(Dumpsters__c DumpsterFor : [Select id, Name, Pick_up_Driver__c, Container_Asset__c, Container_Asset__r.Type__c from Dumpsters__c where id =: DumpsterId ])
            {                
                if(DumpsterFor.Container_Asset__c != null && DumpsterFor.Container_Asset__r.Type__c.contains('Short') &&  Driver_Name_short.contains(newdumMap.get(DumpsterFor.Id).Pick_up_Driver__c) )
                {
                    
                    system.debug('Inside If condition for Equipement Assert');
                    newdumMap.get(DumpsterFor.Id).addError(Label.Equipment_Asset_Validation + ' ' +String.join(new List<String>(Driver_Name_short), ', '));
                }
                
                if(DumpsterFor.Container_Asset__c != null && DumpsterFor.Container_Asset__r.Type__c.contains('000 & 014') &&  !Driver_Name_000.contains(newdumMap.get(DumpsterFor.Id).Pick_up_Driver__c))
                {
                    System.debug(DumpsterFor.Pick_up_Driver__c);
                    if(newdumMap.get(DumpsterFor.Id).Pick_up_Driver__c !='Unscheduled')
                    {
                        system.debug('Inside If condition for Equipement Assert');
                        newdumMap.get(DumpsterFor.Id).addError(Label.Equipment_Asset_Validation_000_014 +' '+String.join(new List<String>(Driver_Name_000), ', '));
                    }
                }
                
                if(DumpsterFor.Container_Asset__c != null && DumpsterFor.Container_Asset__r.Type__c =='Open Top' && Driver_Name_000.contains(newdumMap.get(DumpsterFor.Id).Pick_up_Driver__c))//67422
                {
                    
                    system.debug('Inside If condition for Equipement Assert >>>3');
                    newdumMap.get(DumpsterFor.Id).addError(Label.Equipment_Asset_Validation_OpenTop+ ' ' +String.join(new List<String>(Driver_Name_000), ', '));
                }
                
            }
        }
    }
    
    public void comments_replace(List<Dumpsters__c> newMap)
    {
        for(Dumpsters__c DumpsterFor : newMap)
        {
            system.debug('inside comments');
            if(DumpsterFor.Comments__c != null && DumpsterFor.Comments__c.contains('<<') && DumpsterFor.Comments__c.contains('>>'))
            {
                system.debug('inside <<>>');
                String ReplaceComment = DumpsterFor.Comments__c.SubstringAfter('<<').substringbefore('>>');
                system.debug(ReplaceComment);
                DumpsterFor.Comments_Helper__c = DumpsterFor.Comments__c.replace('<<'+ReplaceComment+'>>','');
            }
            else
            {
                DumpsterFor.Comments_Helper__c = DumpsterFor.Comments__c;
            }
        }
    }
    
    /*-----------------------------------------------------------------------------------------
Method Name: InvoiceCreation(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap)
Amended    : 4-Dec-2018
-------------------------------------------------------------------------------------------*/
    public void InvoiceCreation(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap){
        
        List<id> DumpsterIdList = new List<id>();
        Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();
        List<Dumpster_Invoice__c> InitialDumpsterInvoiceList = new List<Dumpster_Invoice__c>();
        List<Dumpster_Invoice__c> FinalDumpsterInvoiceList = new List<Dumpster_Invoice__c>();
        Map<id,String> DumpsterandDumpsterinvoiceMap = new Map<id,String>();
        List<Dumpsters__c> DumpsterList = new  List<Dumpsters__c>();
        
        
        for(Dumpsters__c dumpster:[select id,initial_invoice_count__c,Fill_Details__c,Dumpster_Weight__c ,AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c ,Concrete_Only__c ,Interim_Invoices__c,Haulbrooke_Regional_Base__c,Final_invoice_count__c,Card_Run__c,Prohibited_Items__c,Consolidate_Invoice__c,name,AAccountccount__r.Consolidated_Invoice__c,Status__c,Dumpster_Size__c,Sales_Tax__c,Extra_Rental_Charge_Per_Day__c ,Dumpster_Rental_Price__c ,Per_Ton_Charge__c ,AAccountccount__c,AAccountccount__r.Email_1__c,AAccountccount__r.Email_2__c,AAccountccount__r.Email_3__c,AAccountccount__r.Email_4__c,Initial_Invoice_Subtotal__c,Other_Charges__c,Wait_Charge__c,Final_Invoice_Subtotal__c,Tonnage_Quantity__c,Additional_Tonnage_Quantity__c,Extra_Rental_DaysF__c,Rental__c,Initial_Invoice_Number__c,Final_Invoice_Number__c from Dumpsters__c where id=:newdumMap.keyset()]){
            
            if(((olddumMap == null && dumpster.Status__c=='Pick-Up Scheduled' && dumpster.AAccountccount__r.Consolidated_Invoice__c != 'Yes')||((olddumMap!=null && olddumMap.get(dumpster.id).Status__c != dumpster.Status__c) && dumpster.Status__c=='Pick-Up Scheduled' && dumpster.Consolidate_Invoice__c != 'Yes') && dumpster.Rental__c=='Dumpster Rental') && dumpster.Final_invoice_count__c==0 && dumpster.Final_Invoice_Number__c==null ){  
                DumpsterIdList.add(dumpster.id);
                Dumpster_Invoice__c DumpsterInvoice = new Dumpster_Invoice__c();
                DumpsterInvoice.Dumpsters__c        = dumpster.id;
                //DumpsterInvoice.Description__c      = 'Dumpster Rental';      //17726
                DumpsterInvoice.Invoice_Date__c     = System.today();
                DumpsterInvoice.Date_Due__c         = System.today();
                
                
                DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
                DumpsterInvoice.Additional_Email__c = dumpster.AAccountccount__r.Email_2__c;
                DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
                DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
                
                String Email1 = Label.Invoice_Email_1; 
                String Email2 = Label.Invoice_Email_2;
                
                String AccountId =dumpster.AAccountccount__c ;
                AccountId= AccountId.substring(0,AccountId.length()-3);
                
                if(Email1.Contains(AccountId ) || Test.isRunningTest()){
                    DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
                    DumpsterInvoice.Additional_Email__c = null;
                    DumpsterInvoice.Additional_Email2__c = null;
                    DumpsterInvoice.Additional_Email3__c = null;
                }
                
                if(Email2.Contains(AccountId ) || Test.isRunningTest()){
                    DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_2__c;
                    DumpsterInvoice.Additional_Email__c = null; 
                    DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
                    DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
                }
                
                if(Label.Description_Dumpster_Size.Contains(AccountId ) || Test.isRunningTest())            // If else added for Ticket 35326
                {
                    DumpsterInvoice.Description__c      = 'Final Invoice, Additional Ton - ' + dumpster.Dumpster_Size__c;      //17726
                }
                else if(Label.Haul_Only.contains(AccountId))
                {
                    DumpsterInvoice.Description__c      = 'Haul Only';
                }
                else if(Label.Haul_Including_3_ton.contains(AccountId))
                {
                    DumpsterInvoice.Description__c      = 'Haul Including 3 ton';
                }
                else
                {
                    DumpsterInvoice.Description__c      = 'Dumpster Rental';      //17726
                }
                
                DumpsterInvoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Final Invoice').getRecordTypeId();
                
                if(dumpster.Fill_Details__c == 'Concrete Only' && dumpster.Haulbrooke_Regional_Base__c =='Houston')
                {
                    DumpsterInvoice.Per_Ton_Charge__c = Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c;  //51785
                    system.debug('Concrete per ton houston runned >>' +Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c);
                }
                else
                {
                    DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
                }
                DumpsterInvoice.Other_Charges__c             = Dumpster.Other_Charges__c;
                DumpsterInvoice.Dumpster_Weight__c =Dumpster.Dumpster_Weight__c;
                DumpsterInvoice.Wait_Charge__c      = Dumpster.Wait_Charge__c;
                DumpsterInvoice.Extra_Rental_Charge_Per_Day__c  = Dumpster.Extra_Rental_Charge_Per_Day__c;
                DumpsterInvoice.Final_Invoice_Subtotal__c       = Dumpster.Final_Invoice_Subtotal__c;
                DumpsterInvoice.Additional_Tonnage_Quantity__c  = Dumpster.Additional_Tonnage_Quantity__c;
                DumpsterInvoice.Extra_Rental_Days__c            = Dumpster.Extra_Rental_DaysF__c;
                DumpsterInvoice.Sales_Tax__c                    = Dumpster.Sales_Tax__c; 
                DumpsterInvoice.Account__c                      = Dumpster.AAccountccount__c;
                DumpsterInvoice.Prohibited_Items__c             = Dumpster.Prohibited_Items__c;
                DumpsterInvoice.Card_Run__c                     = Dumpster.Card_Run__c;
                FinalDumpsterInvoiceList.add(DumpsterInvoice);
                
            }
            
            if((olddumMap==null &&  dumpster.Rental__c=='Dumpster Rental' && dumpster.Initial_Invoice_Number__c==null && dumpster.AAccountccount__r.Consolidated_Invoice__c != 'Yes') && dumpster.Initial_invoice_count__c==0 ){ 
                DumpsterIdList.add(dumpster.id);
                
                Dumpster_Invoice__c DumpsterInvoice = new Dumpster_Invoice__c();
                DumpsterInvoice.Dumpsters__c        = dumpster.id;
                //DumpsterInvoice.Description__c      = 'Dumpster Rental';   //17726
                DumpsterInvoice.Invoice_Date__c     = System.today();
                DumpsterInvoice.Date_Due__c         = System.today();
                DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
                DumpsterInvoice.Additional_Email__c = dumpster.AAccountccount__r.Email_2__c;
                DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
                DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
                
                String Email1 = Label.Invoice_Email_1; 
                String Email2 = Label.Invoice_Email_2; 
                
                
                String AccountId =dumpster.AAccountccount__c ;
                AccountId= AccountId.substring(0,AccountId.length()-3);
                
                if(Email1.Contains(AccountId ) || Test.isRunningTest()){
                    DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
                    DumpsterInvoice.Additional_Email__c = null;
                    DumpsterInvoice.Additional_Email2__c = null;
                    DumpsterInvoice.Additional_Email3__c = null;
                }
                
                if(Email2.Contains(AccountId ) || Test.isRunningTest()){
                    DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_2__c;
                    DumpsterInvoice.Additional_Email__c = null ; 
                    DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
                    DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
                }
                System.debug(Label.Haul_Only+'  '+AccountId);
                System.debug(Label.Haul_Including_3_ton+'  '+AccountId);
                if(Label.Description_Dumpster_Size.Contains(AccountId ) || Test.isRunningTest())            // If else added for Ticket 35326
                {
                    DumpsterInvoice.Description__c      = 'Dumpster Rental - ' + dumpster.Dumpster_Size__c;
                }
                else if(Label.Haul_Only.contains(AccountId))
                {
                    DumpsterInvoice.Description__c      = 'Haul Only';
                }
                else if(Label.Haul_Including_3_ton.contains(AccountId))
                {
                    DumpsterInvoice.Description__c      = 'Haul Including 3 ton';
                }
                else
                {
                    DumpsterInvoice.Description__c      = 'Dumpster Rental';      //17726
                }
                /*if(Email3.Contains(AccountId ) || Test.isRunningTest()){
DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_3__c;
DumpsterInvoice.Additional_Email__c = null;
}
if(Email4.Contains(AccountId ) || Test.isRunningTest()){
DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_4__c;
DumpsterInvoice.Additional_Email__c = null;
}*/
                DumpsterInvoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Initial Invoice').getRecordTypeId();
                DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
                system.debug('initial inv per ton on inv  ---'+DumpsterInvoice.Per_Ton_Charge__c );
                system.debug('Dumpster per ton on inv >>>>'+Dumpster.Per_Ton_Charge__c );
                DumpsterInvoice.Dumpster_Rental_price__c     = Dumpster.Dumpster_Rental_price__c;
                DumpsterInvoice.Initial_Invoice_Subtotal__c  = Dumpster.Initial_Invoice_Subtotal__c;
                DumpsterInvoice.Tonnage_Quantity__c             = Dumpster.Tonnage_Quantity__c;
                DumpsterInvoice.Sales_Tax__c                    = Dumpster.Sales_Tax__c;
                DumpsterInvoice.Account__c                      = Dumpster.AAccountccount__c;
                DumpsterInvoice.Card_Run__c                     = Dumpster.Card_Run__c; 
                InitialDumpsterInvoiceList.add(DumpsterInvoice);
                
            }    
            
        }
        System.debug(InitialDumpsterInvoiceList.size()+' '+InitialDumpsterInvoiceList);
        if(InitialDumpsterInvoiceList.size()>0){
            try{
                insert InitialDumpsterInvoiceList;
                System.debug('inserted');
            }
            catch(exception e){
                system.debug('Exception Raised Due to'+e);
            }
            
            
            
        }
        
        if(FinalDumpsterInvoiceList.size()>0){
            try{
                insert FinalDumpsterInvoiceList;
                
            }
            catch(exception e){
                system.debug('Exception Raised Due to'+e);
            }
            
            
            
        }
        
        
        
        
    }
    
    
    /*-----------------------------------------------------------------------------------------
Method Name: InvoiceUpdates(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap)
Amended    : 4-Dec-2018
-------------------------------------------------------------------------------------------*/
    public void InvoiceUpdates(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap){
        
        List<id> DumpsterIdList = new List<id>();
        Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();
        List<Dumpster_Invoice__c> DumpsterInvoiceList = new List<Dumpster_Invoice__c>();
        
        
        for(Dumpsters__c dumpster:newdumMap.values()){
            if(olddummap!=null &&  dumpster.Rental__c=='Dumpster Rental' && dumpster.AAccountccount__r.Consolidated_Invoice__c != 'Yes' && olddummap.get(Dumpster.id).Dumpster_Size__c != Dumpster.Dumpster_Size__c || olddummap.get(Dumpster.id).AAccountccount__c!= Dumpster.AAccountccount__c || olddummap.get(Dumpster.id).Concrete_Only__c != dumpster.Concrete_Only__c || olddummap.get(Dumpster.id).Haulbrooke_Regional_Base__c  != dumpster.Haulbrooke_Regional_Base__c || olddummap.get(Dumpster.id).Per_Ton_Charge__c != Dumpster.Per_Ton_Charge__c || olddummap.get(Dumpster.id).Dumpster_Rental_price__c != Dumpster.Dumpster_Rental_price__c || olddummap.get(Dumpster.id).Initial_Invoice_Subtotal__c != Dumpster.Initial_Invoice_Subtotal__c || olddummap.get(Dumpster.id).Other_Charges__c != Dumpster.Other_Charges__c || olddummap.get(Dumpster.id).Wait_Charge__c != Dumpster.Wait_Charge__c || olddummap.get(Dumpster.id).Extra_Rental_Charge_Per_Day__c != Dumpster.Extra_Rental_Charge_Per_Day__c || olddummap.get(Dumpster.id).Final_Invoice_Subtotal__c != Dumpster.Final_Invoice_Subtotal__c || olddummap.get(Dumpster.id).Tonnage_Quantity__c != Dumpster.Tonnage_Quantity__c || olddummap.get(Dumpster.id).Additional_Tonnage_Quantity__c != Dumpster.Additional_Tonnage_Quantity__c || olddummap.get(Dumpster.id).Confirmed_Pick_Up_Date__c != Dumpster.Confirmed_Pick_Up_Date__c || olddummap.get(Dumpster.id).X10_Days_Rental_Up_Date__c != Dumpster.X10_Days_Rental_Up_Date__c || olddummap.get(Dumpster.id).Sales_tax__c != Dumpster.Sales_tax__c || olddummap.get(Dumpster.id).Prohibited_Items__c != Dumpster.Prohibited_Items__c || olddummap.get(Dumpster.id).Card_Run__c != Dumpster.Card_Run__c){
                DumpstersMap.put(dumpster.id,dumpster);
                system.debug('value are------------------------>'+dumpstersMap);
            }
        }
        
        for(Dumpster_Invoice__c DumInvoice : [SELECT Id, Interim__c,Recordtype.name,Prohibited_Items__c,Card_Run__c,Account__r.Email_1__c,Account__r.Concrete_Per_Ton_Charge_Houston__c, Account__r.Email_2__c, Account__r.Email_3__c, Account__r.Email_4__c, Sales_Tax__c, U_M__c, Description__c, Customer_Tax_No__c, Date_Due__c, Invoice_Total__c, Sales_Tax_Amount__c, Customer_Email__c, Invoice_Pending_To_Approve__c, Additional_Email__c, Dumpster_Sync__c, Per_Ton_Charge__c, Dumpster_Rental_price__c, Initial_Invoice_Subtotal__c, Other_Charges__c, Dumpster_Weight__c,Wait_Charge__c, Extra_Rental_Charge_Per_Day__c, Final_Invoice_Subtotal__c, Dumpsters__c, Invoice_Date__c, Tonnage_Quantity__c, Additional_Tonnage_Quantity__c, Extra_Rental_Days__c FROM Dumpster_Invoice__c where Dumpsters__c=:DumpstersMap.keyset() and Dumpster_Sync__c=true]){
            String AccountId =DumpstersMap.get(DumInvoice.Dumpsters__c).AAccountccount__c;
            AccountId= AccountId.substring(0,AccountId.length()-3);
            DumInvoice.Per_Ton_Charge__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Per_Ton_Charge__c;
            if(DumInvoice.Recordtype.name == 'Initial Invoice'){
                system.debug('inside the initial invoice'+dumInvoice);            
                //   If(DumpstersMap.get(DumInvoice.Dumpsters__c).Concrete_Only__c != 'yes' && DumInvoice.Invoice_Pending_To_Approve__c != 'Approved'){        //17733
                DumInvoice.Dumpster_Rental_price__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Dumpster_Rental_price__c;
                //        }
                DumInvoice.Initial_Invoice_Subtotal__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Initial_Invoice_Subtotal__c;
                DumInvoice.Tonnage_Quantity__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Tonnage_Quantity__c;
                //DumInvoice.Card_Run__c = DumpstersMap.get(DumInvoice.Dumpsters__c).Card_Run__c; 
                if(Label.Description_Dumpster_Size.Contains(AccountId ) || Test.isRunningTest())
                {
                    system.debug('Inside Rem If');
                    DumInvoice.Description__c      = 'Dumpster Rental - ' + DumpstersMap.get(DumInvoice.Dumpsters__c).Dumpster_Size__c;      //17726
                }
                else if(!Label.Haul_Including_3_ton.contains(AccountId)&&!Label.Haul_Only.contains(AccountId))
                {
                    system.debug('Inside Rem If else');
                    
                    DumInvoice.Description__c      = 'Dumpster Rental';      //17726
                }
                
                /*
if(DumpstersMap.get(DumInvoice.Dumpsters__c).Per_Ton_Charge__c != DumInvoice.Per_Ton_Charge__c)  
{
DumInvoice.Per_Ton_Charge__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Per_Ton_Charge__c;
system.debug('Update for inital inv per ton charge>>>>'+DumInvoice.Per_Ton_Charge__c);
}              
*/
                
            }
            else if(DumInvoice.Recordtype.name == 'Final Invoice'){
                DumInvoice.Other_Charges__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Other_Charges__c;
                                DumInvoice.Dumpster_Weight__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Dumpster_Weight__c;

                
                DumInvoice.Wait_Charge__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Wait_Charge__c;
                DumInvoice.Extra_Rental_Charge_Per_Day__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Extra_Rental_Charge_Per_Day__c;
                DumInvoice.Final_Invoice_Subtotal__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Final_Invoice_Subtotal__c;
                
                if(!DumInvoice.Interim__c)   //53357,53521
                {
                    DumInvoice.Additional_Tonnage_Quantity__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Additional_Tonnage_Quantity__c; //51360
                }
                
                if(!DumInvoice.Interim__c)
                {
                    DumInvoice.Extra_Rental_Days__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Extra_Rental_DaysF__c;
                }
                else if(DumInvoice.Extra_Rental_Days__c == null)
                {
                    DumInvoice.Extra_Rental_Days__c= DumpstersMap.get(DumInvoice.Dumpsters__c).ExtraRentalDaysfor_Interim__c;
                }
                
                DumInvoice.Sales_Tax__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Sales_Tax__c;
                DumInvoice.Prohibited_Items__c             = DumpstersMap.get(DumInvoice.Dumpsters__c).Prohibited_Items__c; 
                if(Label.Description_Dumpster_Size.Contains(AccountId ) || Test.isRunningTest())
                {
                    system.debug('Inside Rem If');
                    DumInvoice.Description__c      = 'Final Invoice, Additional Ton  ' + DumpstersMap.get(DumInvoice.Dumpsters__c).Dumpster_Size__c;      //17726
                }
                else
                {
                    system.debug('Inside Rem If else');
                    if( !DumInvoice.Interim__c) //DumpstersMap.get(DumInvoice.Dumpsters__c).Interim_Invoices__c!= 'Create' &&
                    {
                        DumInvoice.Description__c      = 'Dumpster Rental';      //17726
                    }
                }
                
                if(DumInvoice.Invoice_Pending_To_Approve__c  =='Unapproved' &&  DumpstersMap.get(DumInvoice.Dumpsters__c).Haulbrooke_Regional_Base__c  == 'Houston' && DumpstersMap.get(DumInvoice.Dumpsters__c).Concrete_Only__c == 'Yes')
                {
                    DumInvoice.Per_Ton_Charge__c = DumInvoice.Account__r.Concrete_Per_Ton_Charge_Houston__c;   //51785
                    system.debug('Update of houston concrete per ton invoice update >> '+ DumInvoice.Account__r.Concrete_Per_Ton_Charge_Houston__c); //DumpstersMap.get(DumInvoice.Dumpsters__c).AAccountccount__r
                }
                /*
else
{    system.debug('Not update of houston concrete per ton invoice update >> ');
DumInvoice.Per_Ton_Charge__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Per_Ton_Charge__c;
}
*/
            }
            
            // DumInvoice.Per_Ton_Charge__c= DumpstersMap.get(DumInvoice.Dumpsters__c).Per_Ton_Charge__c;
            //DumInvoice.Description__c= 'Dumpster Rental';   //17726
            DumInvoice.Account__c   = DumpstersMap.get(DumInvoice.Dumpsters__c).AAccountccount__c;
            DumInvoice.Customer_Email__c = DumInvoice.Account__r.Email_1__c;      //Ticket No :12466
            DumInvoice.Additional_Email__c = DumInvoice.Account__r.Email_2__c;      //Ticket No :12466
            DumInvoice.Additional_Email2__c = DumInvoice.Account__r.Email_3__c;      //Ticket No :28007
            DumInvoice.Additional_Email3__c = DumInvoice.Account__r.Email_4__c;      //Ticket No :28007
            
            String Email1 = Label.Invoice_Email_1; 
            String Email2 = Label.Invoice_Email_2; 
            
            
            
            if(Email1.Contains(AccountId ) || Test.isRunningTest()){
                DumInvoice.Customer_Email__c   = DumInvoice.Account__r.Email_1__c;
                DumInvoice.Additional_Email__c = null;
                DumInvoice.Additional_Email2__c = null;
                DumInvoice.Additional_Email3__c = null;
            }
            
            if(Email2.Contains(AccountId ) || Test.isRunningTest()){
                DumInvoice.Customer_Email__c   = DumInvoice.Account__r.Email_2__c;
                DumInvoice.Additional_Email__c = null ; 
                DumInvoice.Additional_Email2__c = DumInvoice.Account__r.Email_3__c;
                DumInvoice.Additional_Email3__c = DumInvoice.Account__r.Email_4__c;
            }
            
            /* if(Email2.Contains(AccountId ) || Test.isRunningTest()){
DumInvoice.Customer_Email__c   = DumpstersMap.get(DumInvoice.Dumpsters__c).Account_Email3__c;
DumInvoice.Additional_Email__c = null ; 
}
if(Email2.Contains(AccountId ) || Test.isRunningTest()){
DumInvoice.Customer_Email__c   = DumpstersMap.get(DumInvoice.Dumpsters__c).Account_Email4__c;
DumInvoice.Additional_Email__c = null ; 
}*/
            //DumInvoice.Card_Run__c = DumpstersMap.get(DumInvoice.Dumpsters__c).Card_Run__c;  
            
            DumpsterInvoiceList.add(DumInvoice);
        }
        
        if(DumpsterInvoiceList.size()>0){
            try{
                
                update DumpsterInvoiceList;
                
            }
            catch(exception e){
                system.debug('Exception Raised Due to'+e);
            }
        }
        
        
    }
    
    
    
    /*-----------------------------------------------------------------------------------------
Method Name: ChargeUpdates(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap)
Amended    : 4-Dec-2018
-------------------------------------------------------------------------------------------*/
    public void ChargeUpdates(Map<id,Dumpsters__c> newdummap,Map<id,Dumpsters__c> olddummap){
        
        List<id> DumpsterIdList = new List<id>();
        Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();
        Map<String,Decimal> ZipandSalesTaxMap = new Map<String,Decimal>();
        List<Dumpsters__c> DumpsterList = new  List<Dumpsters__c>();
        List<id> AccountId = new List<id>();
        Map<id,Account> AccountMap = new Map<id,Account>();
        
        for(Dumpsters__c dumpster:newdummap.values()){
            if(dumpster.AAccountccount__c!=null &&  dumpster.Rental__c=='Dumpster Rental'){
                AccountId.add(dumpster.AAccountccount__c);
                DumpsterIdList.add(dumpster.id);
            }
        }
        
        if(AccountId.size()>0){
            AccountMap = new Map<id,Account>([select id,Tonnage_Quantity__c,Extra_Rental_Charge_Per_Day__c,Per_Ton_Charge_Austin__c,Extra_Rental_Charge_Per_Day_Austin__c, Dumpster_Rental_Price__c,Per_Ton_Charge__c,Phone from Account where id=:AccountId]);
            /*
for(Zip_Code_based_Sales_Tax__c ZipandSalesTax :[select name,Sales_Tax__c from Zip_Code_based_Sales_Tax__c]){
ZipandSalesTaxMap.put(ZipandSalesTax.name,ZipandSalesTax.Sales_Tax__c);
}
*/
        }
        
        
        
        for(Dumpsters__c Dumpster:[select id,AAccountccount__r.Status__c,Trip_Order__c, Austin_Checkbox_Helper__c,Fill_Details__c, name,Status__c,Concrete_Only__c,Gypsum_Only__c,Metal_Only__c,Wood_Only__c,Extra_Rental_Charge_Per_Day__c,Is_Cloning__c,Sales_Tax__c,Delivery_Zip__c,Dumpster_Rental_Price__c ,Per_Ton_Charge__c ,Card_Run__c,AAccountccount__c,AAccountccount__r.Email_1__c,AAccountccount__r.Email_2__c,Initial_Invoice_Subtotal__c,Other_Charges__c,Dumpster_Weight__c,Wait_Charge__c,Final_Invoice_Subtotal__c,Tonnage_Quantity__c,Additional_Tonnage_Quantity__c,Extra_Rental_Days__c from Dumpsters__c where id=:DumpsterIdList]){
            
            if(Dumpster.Austin_Checkbox_Helper__c){
                Dumpster.Extra_Rental_Charge_Per_Day__c = AccountMap.get(dumpster.AAccountccount__c).Extra_Rental_Charge_Per_Day_Austin__c;
                Dumpster.Per_Ton_Charge__c = AccountMap.get(dumpster.AAccountccount__c).Per_Ton_Charge_Austin__c;
            }
            else{
                Dumpster.Extra_Rental_Charge_Per_Day__c = AccountMap.get(dumpster.AAccountccount__c).Extra_Rental_Charge_Per_Day__c ;
                //Dumpster.Dumpster_Rental_Price__c = AccountMap.get(dumpster.AAccountccount__c).Dumpster_Rental_Price__c;                                    //Dumpster rental price is updated based on Process Builder - Dumpster Rental Price Auto Populate
                Dumpster.Per_Ton_Charge__c = AccountMap.get(dumpster.AAccountccount__c).Per_Ton_Charge__c;
            }
            System.debug('Dumpster.Concrete_Only__c>>>>>>'+Dumpster.Concrete_Only__c);
            if(Dumpster.AAccountccount__r.Status__c =='Payment Before Delivery' && (Dumpster.Status__c =='Scheduled' || Dumpster.Status__c =='Unscheduled'))     //58666forfieldupdate
            {
                System.debug('Dumpster.Concrete_Only__c>>>>>>'+Dumpster.Concrete_Only__c);
                Dumpster.Trip_Order__c = 'Waiting Payment';
            }
            if(!Dumpster.Is_Cloning__c && (Dumpster.Fill_Details__c != 'Concrete Only' || Dumpster.Fill_Details__c != 'Cardboard/Plastic Only' || Dumpster.Fill_Details__c != 'Metal Only' || Dumpster.Fill_Details__c != 'Wood Only')){  // Ticket No : 15316 // 17285
                Dumpster.Tonnage_Quantity__c = AccountMap.get(dumpster.AAccountccount__c).Tonnage_Quantity__c;
            }          
            //Dumpster.Phone_Number_2__c = AccountMap.get(dumpster.AAccountccount__c).Phone;
            /*
if(ZipandSalesTaxMap.containskey(String.ValueOf(Dumpster.Delivery_Zip__c))){
Dumpster.Sales_Tax__c = ZipandSalesTaxMap.get(String.valueOf(Dumpster.Delivery_Zip__c)); //charge updates deactivated as per the customer request 'https://merfantz.freshdesk.com/a/tickets/12189'
}
*/
            DumpsterList.add(Dumpster);
            System.debug(DumpsterList);
            
        }
        if(DumpsterList.size()>0){
            try{
                Update DumpsterList;
                InvoiceCreation(new Map<id,Dumpsters__c>(DumpsterList),olddummap);
            }
            catch(exception e){
            }
        }
    }
    /*====================================================
*Method Name     : duplicatecheckInsPurchaseorder
*Description         : Purchase Order dupliaction checking before insert
====================================================*/   
    public void duplicatecheckInsPurchaseorder(List<Dumpsters__c> newDumplist){
        Map<Id,String> dumplist = new Map<Id,String>();
        Set<String> purchaseNo = new Set<String>();
        
        String AccountId;
        
        for(Dumpsters__c dum : newDumplist){
            if(dum.AAccountccount__c==Label.Haulbrooke)  // 12708
            {
                dum.Invoiced_Amount__c=0;
                dum.Initial_Invoice_Number__c=0;
                dum.Final_Invoice_Number__c=0;
            } 
            if((dum.AAccountccount__c==Label.Guido_Account_Id && dum.Pdf_Parser_Delivery_Address__c == Label.Guido_Address) || (dum.AAccountccount__c == Label.Texas_Department_of_Transportation))  // 23367
            {
                dum.Invoiced_Amount__c=0;
                dum.Initial_Invoice_Number__c=0;
                dum.Final_Invoice_Number__c=0;
                
                //dum.Card_run__c = Label.Initial_Invoice +';'+Label.Final_Invoice;
            } 
            
            if((dum.Purchase_Order__c != '') && (dum.Purchase_Order__c != null))
                purchaseNo.add(dum.Purchase_Order__c);
        }
        for(Dumpsters__c dump : [Select id, Name, AAccountccount__c, Purchase_Order__c from Dumpsters__c where Purchase_Order__c =: purchaseNo]){
            for(Dumpsters__c dump1 : newDumplist){
                if(dump1.AAccountccount__c == Label.Texas_Department_of_Transportation || dump1.AAccountccount__c == Label.C_Brooks_Construction)
                {
                    system.debug('123 '+dump1.AAccountccount__c);
                }             
                else
                {
                    system.debug(dump1.AAccountccount__c);
                    if(dump1.Purchase_Order__c == dump.Purchase_Order__c){
                        dump1.Purchase_Order__c.addError('Duplicate value on record'+' :<a href='+URL.getSalesforceBaseUrl().toExternalForm()+'/'+dump.id+'>'+dump.name+'</a>',false);   //12889
                    }
                }
            }
        }
    }
    /*
public void InsDumpFullAtOffice(Map<id,Dumpsters__c> newMapdump)
{
list<Dumpsters__c> Dumpsterlist = new list<Dumpsters__c>();
for(Dumpsters__c DumpsterFor : newMapdump.values())
{
if(DumpsterFor.Full_At_The_Office__c == 'yes')
{
system.debug(DumpsterFor);
Dumpsters__c Dumpsters = new Dumpsters__c();
Dumpsters.AAccountccount__c = DumpsterFor.AAccountccount__c;
Dumpsters.Gypsum_Only__c = DumpsterFor.Gypsum_Only__c;
Dumpsters.Comments__c = DumpsterFor.Comments_Helper__c;
Dumpsters.Concrete_Only__c = DumpsterFor.Concrete_Only__c;
Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Confirmed_Pick_Up_Date__c;
Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c;
Dumpsters.Driver__c = DumpsterFor.Pick_Up_Driver__c;
Dumpsters.Pdf_Parser_Delivery_Address__c = DumpsterFor.Pdf_Parser_Delivery_Address__c;
Dumpsters.Dumpster_Rental_price__c = DumpsterFor.Dumpster_Rental_price__c;
Dumpsters.Dumpster_Size__c = DumpsterFor.Dumpster_Size__c;
Dumpsters.Estimated_GP__c = DumpsterFor.Estimated_GP__c;
Dumpsters.Invoicing_Comments__c = DumpsterFor.Invoicing_Comments__c;
Dumpsters.Metal_Only__c = DumpsterFor.Metal_Only__c;
Dumpsters.Phone_Number_2__c = DumpsterFor.Phone_Number_2__c;
Dumpsters.Phone_Number_22__c = DumpsterFor.Phone_Number_22__c;
Dumpsters.Pick_Up_Driver__c = DumpsterFor.Pick_Up_Driver__c;
Dumpsters.Rental__c = DumpsterFor.Rental__c;
Dumpsters.Status__c = 'Unscheduled';
Dumpsters.Tonnage_Quantity__c = DumpsterFor.Tonnage_Quantity__c;
Dumpsters.Wood_Only__c = DumpsterFor.Wood_Only__c;
Dumpsters.Purchase_Order__c = DumpsterFor.Purchase_Order__c;
Dumpsters.Is_Cloning__c = true;

Dumpsterlist.add(Dumpsters);
system.debug(Dumpsterlist);
}
}
insert Dumpsterlist;

}
*/
    /*======================================================================
*Method name    : CheckAustinHelper
*Description    : To check whether the Zipcode belongs in Austin
========================================================================= */
    
    public void CheckAustinHelper(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> oldDumpMap){
        Zipcode = System.Label.Zip_Code.split(',');
        system.debug(newdumMap);
        for(Dumpsters__c Dump : newdumMap.values()){
            if(oldDumpMap.get(Dump.Id).Pdf_Parser_Delivery_Address__c != Dump.Pdf_Parser_Delivery_Address__c && Dump.Pdf_Parser_Delivery_Address__c != null && Dump.Full_At_The_Office__c != 'Yes'){
                for(String zip : Zipcode){
                    trimmedZip = zip.trim();
                    if(Dump.Pdf_Parser_Delivery_Address__c.containsIgnoreCase(trimmedZip))
                        count = 1;
                }
                if(count ==1)
                    Dump.Austin_Checkbox_Helper__c = True; 
                else
                    Dump.Austin_Checkbox_Helper__c = False; 
                
                
            }
        }
        
    }
    
    
    public void CheckAustinHelperInsert(List<Dumpsters__c> newDumpList){
        
        system.debug(newDumpList);
        Zipcode = System.Label.Zip_Code.split(',');
        for(Dumpsters__c Dumpster : newDumpList){
            if(Dumpster.Pdf_Parser_Delivery_Address__c != null)
            {
                String Address = Dumpster.Pdf_Parser_Delivery_Address__c; 
                for(String zip : Zipcode){
                    trimmedZip = zip.trim();
                    if(Address.containsIgnoreCase(trimmedZip))
                        count = 1;
                }
                if(count==1)
                    Dumpster.Austin_Checkbox_Helper__c = True; 
                else
                    Dumpster.Austin_Checkbox_Helper__c = False;
            }
        }
    }
    
    
    public void CheckHoustonHelper(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> oldDumpMap){
        Set<String> HoustonZipcodes = new Set<String>();
        String[] Zipcode1 = System.Label.Houston_Zip_Code_1.split(',');
        String[] Zipcode2 = System.Label.Houston_Zip_Code_2.split(',');
        Integer Counthelp;
        HoustonZipcodes.addall(Zipcode1);
        HoustonZipcodes.addall(Zipcode2);
        
        system.debug(newdumMap);
        for(Dumpsters__c Dump : newdumMap.values()){
            if(oldDumpMap.get(Dump.Id).Pdf_Parser_Delivery_Address__c != Dump.Pdf_Parser_Delivery_Address__c && Dump.Pdf_Parser_Delivery_Address__c != null && Dump.Full_At_The_Office__c != 'Yes'){
                for(String zip : HoustonZipcodes){
                    trimmedZip = zip.trim();
                    if(Dump.Pdf_Parser_Delivery_Address__c.containsIgnoreCase(trimmedZip))
                        Counthelp = 1;
                }
                if(Counthelp==1)
                {
                    Dump.Houston_Helper__c = True; 
                    Dump.Haulbrooke_Regional_Base__c = 'Houston';
                }
                else
                {
                    Dump.Houston_Helper__c = False;
                    Dump.Haulbrooke_Regional_Base__c = 'San Antonio';
                } 
                
                
            }
        }
        
    }
    
    public void CheckHoustonHelperInsert(List<Dumpsters__c> newDumpList){
        
        Set<String> HoustonZipcodes = new Set<String>();
        
        system.debug(newDumpList);
        String[] Zipcode1 = System.Label.Houston_Zip_Code_1.split(',');
        String[] Zipcode2 = System.Label.Houston_Zip_Code_2.split(',');
        Integer Counthelp;
        HoustonZipcodes.addall(Zipcode1);
        HoustonZipcodes.addall(Zipcode2);
        
        for(Dumpsters__c Dumpster : newDumpList){
            if(Dumpster.Pdf_Parser_Delivery_Address__c != null)
            {
                String Address = Dumpster.Pdf_Parser_Delivery_Address__c; 
                for(String zip : HoustonZipcodes){
                    trimmedZip = zip.trim();
                    if(Address.containsIgnoreCase(trimmedZip))
                        Counthelp = 1;
                }
                if(Counthelp==1)
                {
                    Dumpster.Houston_Helper__c = True; 
                    Dumpster.Haulbrooke_Regional_Base__c = 'Houston';
                }
                else
                {
                    Dumpster.Houston_Helper__c = False;
                    Dumpster.Haulbrooke_Regional_Base__c = 'San Antonio';
                }
            }
        }
    }
    
    
    /*====================================================

*Method Name     : duplicatecheckPurchaseorder
*Description         : PurchaseOrderDuplicateChecking update
====================================================*/
    public void duplicatecheckPurchaseorder(Map<id,Dumpsters__c> newdummapval){
        Map<String,Dumpsters__c> purchaseDumpster = new Map<String,Dumpsters__c>();
        Set<String> purchaseNo = new Set<String>();
        
        for(Dumpsters__c dum : newdummapval.values()){
            if((dum.Purchase_Order__c != '') && (dum.Purchase_Order__c != null))
                purchaseNo.add(dum.Purchase_Order__c);
            system.debug('purchaseno is'+purchaseNo);
        }
        for(Dumpsters__c dumpster : [Select id,name, Purchase_Order__c from Dumpsters__c where Purchase_Order__c =: purchaseNo]){
            purchaseDumpster.put(dumpster.Purchase_Order__c,dumpster);
            system.debug('purchase dumpster is'+purchaseDumpster);
        }
        for(Dumpsters__c dump : newdummapval.values()){
            system.debug('dump value is'+dump);
            if(dump.AAccountccount__c == Label.Texas_Department_of_Transportation || dump.AAccountccount__c == Label.C_Brooks_Construction)
            {
                system.debug('123 '+dump.AAccountccount__c);
            }             
            else
            {
                if(PurchaseDumpster.Containskey(dump.Purchase_Order__c) && (PurchaseDumpster.get(dump.Purchase_Order__c).id != dump.id)){
                    dump.Purchase_Order__c.addError('Duplicate value on record'+' : <a href='+URL.getSalesforceBaseUrl().toExternalForm()+'/'+PurchaseDumpster.get(dump.Purchase_Order__c).id+'>'+ PurchaseDumpster.get(dump.Purchase_Order__c).name+'</a>',false);  //12889
                }
            }
        }
    }
    /*=====================================Ticket No : 14521====================================================
*Method Name     : public static void DumpsterRecordAlert (Map<Id,Dumpsters__c> newdumMap)
*Description     : Querying record based on some criteria and that count greater than or equal to 30 in dumpster it will send the email alert.
*Arguments       : To get NewDUmpValues.
============================================================================================================*/
    Public void DumpsterRecordAlert(Map<id,Dumpsters__c> newDumMapval){
        Integer Temp=0;
        Boolean first = true;
        Integer Recordcount;
        Set<Date> DumpDateSet = new Set<Date>();
        List<Dumpsters__c> dumplist = new List<Dumpsters__c>();
        Map<date,Integer> DumpsterMap = new Map<date,Integer>();
        String query = 'Select id,name,EmailAlertDate__c  from Dumpsters__c';
        
        for(Dumpsters__c dump : newDumMapval.values()){
            if(dump.Drop_Off_Visit_Date__c != null){
                DumpDateSet.add(dump.Drop_Off_Visit_Date__c);
            }
            if(dump.Confirmed_Pick_Up_Date__c != null){
                DumpDateSet.add(dump.Confirmed_Pick_Up_Date__c);
            }
        }
        
        for(date ele : DumpDateSet){
            if(!first){
                query += ' OR';
            } else {
                query += ' WHERE';
            }
            query = query + ' EmailAlertDate__c LIKE \'%' + String.valueof(ele).substringBefore(' ')+ '%\'';
            first = false;
        }
        System.debug(query);
        
        system.debug('DumpDateSet value before is '+DumpDateSet);
        for(Dumpsters__c dump :database.query(query))
            for(date ele : DumpDateSet)
            if(String.valueof(dump.EmailAlertDate__c).contains(String.valueof(ele).substringBefore(' ')))
            DumpdateSet.remove(ele);
        
        
        system.debug('DumpDateSet value After is '+DumpDateSet);
        for(AggregateResult DropOffDate : [SELECT  count(id) rcount,Drop_Off_Visit_Date__c VisitDate FROM Dumpsters__c where Drop_Off_Visit_Date__c =: DumpDateSet and (Status__c='Unscheduled' or Status__c='Scheduled' or Status__c='Request for Pick-Up') GROUP BY  Drop_Off_Visit_Date__c ]){
            DumpsterMap.put(date.valueof(DropOffDate.get('VisitDate')),Integer.valueof(DropOffDate.get('rcount')));
            
        }
        System.debug('DumpsterMap First Aggregate is--------->'+DumpsterMap);
        for(AggregateResult ConPickupDate : [SELECT count(id) rcount,Confirmed_Pick_Up_Date__c PickUpdate FROM Dumpsters__c where Confirmed_Pick_Up_Date__c =: DumpDateSet and (Status__c='Unscheduled' or Status__c='Scheduled' or Status__c='Request for Pick-Up') GROUP BY  Confirmed_Pick_Up_Date__c]){
            if(DumpsterMap.containskey(date.valueof(ConPickupDate.get('PickUpdate')))){  
                DumpsterMap.put(date.valueof(ConPickupDate.get('PickUpdate')),DumpsterMap.get(date.valueof(ConPickupDate.get('PickUpdate')))+Integer.valueof(ConPickupDate.get('rcount')));
            }
            else{
                DumpsterMap.put(date.valueof(ConPickupDate.get('PickUpdate')),Integer.valueof(ConPickupDate.get('rcount')));
            }
        }
        System.debug('DUmpsterMap Second Aggregate Result is --------->'+DumpsterMap);
        String DumpDateString='';
        for(date DumpDate : DumpsterMap.keyset()){
            RecordCount = Integer.valueof(DumpsterMap.get(DumpDate));
            if(DumpsterMap.get(DumpDate) >= Integer.valueof(Label.Record_Limit_Alert))
                if(DumpDateString!='' && DumpDateString!=null){
                    DumpDateString=DumpDateString+' , '+String.valueof(DumpDate).substringBefore(' ');
                    Recordcount = Integer.valueOf(DumpsterMap.get(DumpDate));
                }    
            else{
                DumpDateString=String.valueof(DumpDate).substringBefore(' ');
                Recordcount = Integer.valueOf(DumpsterMap.get(DumpDate));
            }
        }
        
        if(DumpDateString != '' && DumpDateString != null){
            
            System.debug('Dumpster Date String value is'+DumpDateString);
            SendingMail(DumpDateString,String.valueOf(Label.Record_Limit_Alert)+' Dumpster Record Alert ',RecordCount);
            for(Dumpsters__c dump :[Select id,name,Drop_Off_Visit_Date__c,Confirmed_Pick_Up_Date__c,EmailAlertDate__c  from Dumpsters__c where id=:newDumMapval.Keyset()]){
                Temp=0;
                if(DumpDateString.contains(String.valueOf(dump.Drop_Off_Visit_Date__c))){
                    Temp=1;
                    dump.EmailAlertDate__c =dump.EmailAlertDate__c +' - '+ String.valueOf(DumpDateString);
                }
                if(dump.Confirmed_Pick_Up_Date__c!=null)
                    if(DumpDateString.contains(String.valueOf(dump.Confirmed_Pick_Up_Date__c))){
                        Temp=1;
                        dump.EmailAlertDate__c =dump.EmailAlertDate__c +' - '+ String.valueOf(DumpDateString);
                    }
                if(Temp==1)
                    dumplist.add(dump);
            }
            if(Dumplist.size() > 0){
                try{
                    update Dumplist;
                }Catch(Exception e){
                    System.debug('Exception raised due to ------------------->'+e);
                }
                
            }
        }
    }
    
    /*=====================================Ticket No : 15210====================================================
*Method Name     : public static void FifteenDumpsterRecordAlert(Map<Id,Dumpsters__c> newdumMap)
*Description     : Querying record based on some criteria and that count greater than or equal to 15 in dumpster it will send the email alert.
*Arguments       : To get NewDUmpValues.
============================================================================================================*/
    Public void FifteenDumpsterRecordAlert(Map<id,Dumpsters__c> newDumMapval){
        Integer Temp=0;
        Boolean first = true;
        Integer Recordcount;
        Set<Date> DumpDateSet = new Set<Date>();
        List<Dumpsters__c> dumplist = new List<Dumpsters__c>();
        Map<date,Integer> DumpsterMap = new Map<date,Integer>();
        String query = 'Select id,name,X15_Record_Email_Alert_Send_Date__c from Dumpsters__c';
        
        for(Dumpsters__c dump : newDumMapval.values()){
            /*if(dump.Drop_Off_Visit_Date__c != null){
DumpDateSet.add(dump.Drop_Off_Visit_Date__c);
}*/
            if(dump.Confirmed_Pick_Up_Date__c != null){
                DumpDateSet.add(dump.Confirmed_Pick_Up_Date__c);
            }
        }
        
        for(date ele : DumpDateSet){
            if(!first){
                query += ' OR';
            } else {
                query += ' WHERE';
            }
            query = query + ' X15_Record_Email_Alert_Send_Date__c LIKE \'%' + String.valueof(ele).substringBefore(' ')+ '%\'';
            first = false;
        }
        System.debug(query);
        system.debug('DumpDateSet value before is '+DumpDateSet);
        for(Dumpsters__c dump :database.query(query))
            for(date ele : DumpDateSet)
            if(String.valueof(dump.X15_Record_Email_Alert_Send_Date__c).contains(String.valueof(ele).substringBefore(' ')))
            DumpdateSet.remove(ele);       
        system.debug('DumpDateSet value After is '+DumpDateSet);
        /*for(AggregateResult DropOffDate : [SELECT  count(id) rcount,Drop_Off_Visit_Date__c VisitDate FROM Dumpsters__c where Drop_Off_Visit_Date__c =: DumpDateSet and (Status__c='Request for Pick-Up') GROUP BY  Drop_Off_Visit_Date__c ]){
DumpsterMap.put(date.valueof(DropOffDate.get('VisitDate')),Integer.valueof(DropOffDate.get('rcount')));

} 
System.debug('DumpsterMap First Aggregate is--------->'+DumpsterMap); */
        if(DumpDateSet.size() > 0){
            for(AggregateResult ConPickupDate : [SELECT count(id) rcount,Confirmed_Pick_Up_Date__c PickUpdate FROM Dumpsters__c where Confirmed_Pick_Up_Date__c =: DumpDateSet and (Status__c='Request for Pick-Up') GROUP BY  Confirmed_Pick_Up_Date__c]){
                DumpsterMap.put(date.valueof(ConPickupDate.get('PickUpdate')),Integer.valueof(ConPickupDate.get('rcount')));
            }
            System.debug('DUmpsterMap Aggregate Result is --------->'+DumpsterMap);
            String DumpDateString=''; 
            for(date DumpDate : DumpsterMap.keyset()){
                if(DumpsterMap.get(DumpDate) >= Integer.valueof(Label.FifteenRecordAlert))
                    if(DumpDateString!='' && DumpDateString!=null){
                        DumpDateString=DumpDateString+' , '+String.valueof(DumpDate).substringBefore(' ');
                        Recordcount = Integer.valueOf(DumpsterMap.get(DumpDate));
                    }
                else{
                    DumpDateString=String.valueof(DumpDate).substringBefore(' ');
                    Recordcount = Integer.valueOf(DumpsterMap.get(DumpDate));
                }
            }
            if(DumpDateString != '' && DumpDateString != null){
                
                System.debug('Dumpster Date String value is'+DumpDateString);
                SendingMail(DumpDateString,String.valueOf(Label.FifteenRecordAlert)+' Dumpster Record Alert ', RecordCount);          
                for(Dumpsters__c dump :[Select id,name,Drop_Off_Visit_Date__c,Confirmed_Pick_Up_Date__c,X15_Record_Email_Alert_Send_Date__c from Dumpsters__c where id=:newDumMapval.Keyset()]){
                    if(DumpDateString.contains(String.valueOf(dump.Confirmed_Pick_Up_Date__c))){
                        dump.X15_Record_Email_Alert_Send_Date__c = String.valueOf(DumpDateString);
                        dumplist.add(dump);
                    }
                }
                if(Dumplist.size() > 0){
                    try{
                        update Dumplist;
                    }Catch(Exception e){
                        System.debug('Exception raised due to ------------------->'+e);
                    }         
                }
            }    
        }
    }
    
    public void update_trip_SMS(Map<id, Dumpsters__c> newMap, Map<id, Dumpsters__c> oldMap)
    {
        Map<String, String> Drivers = new Map<String, String>();
        Map<String, Dumpsters__c> Driver_Dumpster_Map = new Map<String, Dumpsters__c>();
        List<Dumpsters__c> Dumpster_Update = new List<Dumpsters__c>();
        List<SMS_Log__c> SMS_Log_Creation = new List<SMS_Log__c>();
        System.debug('Test>>>>>>>>>>Came'+newMap);
        for(Dumpsters__c Dumpsterfor : newMap.values())
        {
            if(Dumpsterfor.Status__c == 'Drop Off Complete' || Dumpsterfor.Status__c == 'Request for Pick-Up')
            {
                Drivers.put(Dumpsterfor.Driver__c, Dumpsterfor.Trip_Order__c);
                System.debug('dropoff & requestfor >>'+Drivers);
            }
            else if(Dumpsterfor.Status__c == 'Pick-Up Scheduled')
            {
                Drivers.put(Dumpsterfor.Pick_Up_Driver__c, Dumpsterfor.Trip_Order__c);
                System.debug('Pickup driver >>'+Drivers);
            }
        }
        
        for(Dumpsters__c Dumpsterfor : [Select id, Name, Full_At_The_Office__c, Status__c, Phone_Number__c, Phone_Number_22__c, Haulbrooke_Regional_Base__c, Phone_Number_2__c, Driver__c, Pick_up_driver__c, Dumpster_Trip_SMS_Date__c, Service_Date__c, Trip_Order__c from Dumpsters__c where ((Status__c = 'Scheduled' and Drop_Off_Visit_Date__c = TODAY and Driver__c =: Drivers.keyset()) or (Status__c = 'Request for Pick-Up' and Confirmed_Pick_Up_Date__c = TODAY and Pick_up_driver__c =: Drivers.keyset())) order by Trip_Order__c])
        {
            if(Drivers.get(Dumpsterfor.Driver__c) != 'Waiting Payment' && Drivers.get(Dumpsterfor.Driver__c) != 'Short')
            {
                if(Dumpsterfor.Status__c == 'Scheduled') //59203
                {
                    system.debug('inside scheduled');
                    Integer TripNumberCheck1 = Integer.valueOf(Drivers.get(Dumpsterfor.Driver__c)) + 1;
                    Integer TripNumberCheck2 = Integer.valueOf(Drivers.get(Dumpsterfor.Driver__c)) + 2;
                    
                    system.debug(TripNumberCheck1);
                    system.debug(TripNumberCheck2);
                    
                    if(!Driver_Dumpster_Map.containskey(Dumpsterfor.Driver__c) && (String.valueOf(TripNumberCheck1) == Dumpsterfor.Trip_Order__c || String.valueOf(TripNumberCheck2) == Dumpsterfor.Trip_Order__c))
                        Driver_Dumpster_Map.put(Dumpsterfor.Driver__c, Dumpsterfor);
                    system.debug('checking trip order'+Dumpsterfor.Trip_Order__c);
                }
                else if(Dumpsterfor.Status__c == 'Request for Pick-Up' || Dumpsterfor.Status__c == 'Relocation')
                {
                    system.debug('inside requestfor&relocation');
                    
                    Integer TripNumberCheck1 = Integer.valueOf(Drivers.get(Dumpsterfor.Pick_up_driver__c)) + 1;
                    Integer TripNumberCheck2 = Integer.valueOf(Drivers.get(Dumpsterfor.Pick_up_driver__c)) + 2;
                    
                    system.debug(TripNumberCheck1);
                    system.debug(TripNumberCheck2);
                    
                    if(!Driver_Dumpster_Map.containskey(Dumpsterfor.Pick_up_driver__c) && (String.valueOf(TripNumberCheck1) == Dumpsterfor.Trip_Order__c || String.valueOf(TripNumberCheck2) == Dumpsterfor.Trip_Order__c))
                        Driver_Dumpster_Map.put(Dumpsterfor.Pick_up_driver__c, Dumpsterfor);
                }
            }
        }
        
        system.debug(Driver_Dumpster_Map);
        
        for(Dumpsters__c Dumpsterfor : Driver_Dumpster_Map.values())
        {
            system.debug('check map value');
            /*Dumpsterfor.Dumpster_Trip_SMS_Date__c = System.now().addminutes(5);
if(Dumpsterfor.Dumpster_Trip_SMS_Date__c.format('a') == 'AM')
{
Dumpsterfor.Trip_Time_is_AM__c = true;
}
Dumpster_Update.add(Dumpsterfor);*/
            system.debug(Dumpsterfor.Full_At_The_Office__c);
            Boolean SMS_Trips = false;
            String morning,noon,evening;
            
            Datetime CrrntTime;
            CrrntTime = system.now();
            
            
            if(Dumpsterfor.Full_At_The_Office__c != 'Yes')
            {
                
                if(Dumpsterfor.Phone_Number_2__c != null)
                {    system.debug('1');
                 SMS_Log__c SMS_Log = new SMS_Log__c();
                 SMS_Log.Dumpsters__c = Dumpsterfor.Id;
                 SMS_Log.From_Number__c = Dumpsterfor.Haulbrooke_Regional_Base__c == 'San Antonio' ? '+12103612496' : '+12817294975';
                 SMS_Log.SMS_Details__c = (system.now().format('a') == 'AM' ? 'Good Morning,\n\n' : System.now().hour()<19?'Good Afternoon,\n\n':'Good Evening,\n\n') + Label.Trip_SMS_Details.replace('<<DUMPSTERRECORDID>>', Dumpsterfor.Id);
                 SMS_Log.To_Number__c = Dumpsterfor.Phone_Number_2__c;
                 SMS_Log_Creation.add(SMS_Log);
                 SMS_Trips = true;
                }
                if(Dumpsterfor.Phone_Number_22__c != null)
                {    system.debug('2');
                 SMS_Log__c SMS_Log1 = new SMS_Log__c();
                 SMS_Log1.Dumpsters__c = Dumpsterfor.Id;
                 SMS_Log1.From_Number__c = Dumpsterfor.Haulbrooke_Regional_Base__c == 'San Antonio' ? '+12103612496' : '+12817294975';
                 SMS_Log1.SMS_Details__c = (system.now().format('a') == 'AM' ? 'Good Morning,\n\n' : System.now().hour()<19?'Good Afternoon,\n\n':'Good Evening,\n\n') + Label.Trip_SMS_Details.replace('<<DUMPSTERRECORDID>>', Dumpsterfor.Id);    // 52428  (system.now().format('a') == 'AM' ? 'Good Morning,\n\n' : 'Good Evening,\n\n') 
                 SMS_Log1.To_Number__c = Dumpsterfor.Phone_Number_22__c;
                 SMS_Log_Creation.add(SMS_Log1);
                 SMS_Trips = true;
                }                            
                
                
                if(!SMS_Trips)
                {    system.debug('3');
                 SMS_Log__c SMS_Log2 = new SMS_Log__c();
                 SMS_Log2.Dumpsters__c = Dumpsterfor.Id;
                 SMS_Log2.From_Number__c = Dumpsterfor.Haulbrooke_Regional_Base__c == 'San Antonio' ? '+12103612496' : '+12817294975';
                 SMS_Log2.SMS_Details__c = (system.now().format('a') == 'AM' ? 'Good Morning,\n\n' : System.now().hour()<19?'Good Afternoon,\n\n':'Good Evening,\n\n') + Label.Trip_SMS_Details.replace('<<DUMPSTERRECORDID>>', Dumpsterfor.Id);
                 SMS_Log2.To_Number__c = Dumpsterfor.Phone_Number__c;
                 SMS_Log_Creation.add(SMS_Log2);
                }
            }
            
            
        }
        system.debug('SMS_Log_Creation>>> '+SMS_Log_Creation);
        try
        {
            if(SMS_Log_Creation.size() > 0)
            {
                insert SMS_Log_Creation;
                System.debug('Inserted');
            }
        }
        catch(exception e)
        {
            system.debug('EEEEEEEEEEEEEEE>> '+e);
        }
    }
    
    /*=========================================================================================
*Method Name     : public static void SendingErrorMail(String Dates, String emailsubject)
*Description     : If any Error or Exception occurs it will send the Error detail to the email.
*Arguments       : To get a Exception content and Email subject to for the Reference
===========================================================================================*/
    public static void SendingMail(String RecordDate, String emailsubject, Integer RecordCount){
        if(RecordDate != ''){
            
            Messaging.SingleEmailMessage mail = new Messaging.SingleEmailMessage();
            String EmailToAddress = Label.Warren_Email; 
            System.debug(EmailToAddress);
            if(EmailToAddress!=null){
                try{
                    String[] toAddresses = new String[] {EmailToAddress};
                        mail.setToAddresses(toAddresses);
                    mail.setSenderDisplayName('Salesforce Support');
                    mail.setSubject(emailSubject);
                    if(RecordCount >= Integer.valueOf(Label.Record_Limit_Alert)){
                        mail.setHtmlBody('Hi Warren, <br/><br/>Below date are '+String.valueOf(Label.Record_Limit_Alert)+' Dumpster records for the same Drop Off / Visit Date or Confirmed Pick-Up Date, that have a Status of Unscheduled, Scheduled or Request For Pick-Up </b><br/>' +'Dates: '+RecordDate+'</b><br/><br/><b>Regards,<br/>Salesforce Support</b>');
                    }else if(RecordCount >= Integer.valueOf(Label.FifteenRecordAlert)){
                        mail.setHtmlBody('Hi Warren, <br/><br/>Below date are '+String.valueOf(Label.FifteenRecordAlert)+' Dumpster records for the same Confirmed Pick-Up Date, that have a Status of Request For Pick-Up </b><br/>' +'Dates: '+RecordDate+'</b><br/><br/><b>Regards,<br/>Salesforce Support</b>');
                    }
                    Messaging.sendEmail(new Messaging.SingleEmailMessage[] { mail });
                }
                catch(exception e){
                    System.debug('Exception raised due to ->'+e);
                }
            }
        }
    }
    /*==================================17284=======================================================
*Method Name     : public static void Final
CardRunUpdates()
*Description     : If FInal Number as 0, to add FInal Invoice into CardRun? field.If that field is blank, it will display only Final Invoice.
*Arguments       : To get a new values from Dumpster object.
===========================================================================================*/
    public static void FinalInvoiceCardRunUpdates(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> OlddumMap){
        Map<id, Dumpsters__c> DumpMap = new Map<id, DUmpsters__c>();
        for(Dumpsters__c dum : [select id, Name , Card_Run__c, Final_invoice_Number__c from dumpsters__c where id=:newdumMap.keySet()]){
            if((OlddumMap == null && dum.Final_invoice_Number__c == 0) || (OlddumMap != null && dum.Final_Invoice_Number__c == 0 && OlddumMap.get(dum.id).FInal_Invoice_Number__c != dum.Final_invoice_number__c)){
                if((dum.Card_Run__c != null) && (!dum.Card_Run__C.containsIgnoreCase(Label.Final_Invoice))){
                    dum.Card_run__c = dum.Card_run__c +';'+Label.Final_Invoice;
                    system.debug('if Card Run value is'+dum.Card_Run__c);
                }else{
                    dum.Card_run__c = Label.Final_Invoice;
                    system.debug('else Card Run value is'+dum.Card_Run__c);
                }
                DumpMap.put(dum.id,dum);
            }
        }
        if(DumpMap.size() > 0){
            try{
                update DumpMap.values();
            }
            catch(Exception e){
                System.debug('Exception raised due to ------------------>'+e);
            }
        }
    } 
    
    /*==================================18642=======================================================
*Method Name     : public void UpdateGeocodes()
*Description     : To update the geocode from the address in dumpster records.
*Arguments       : To get a new values from Dumpster object.
===========================================================================================*/
    @future(callout=true)
    public static void UpdateGeoCodes(Set<ID> newDumpIDSet){
        system.debug('Inside the UpdateGeoCodes');
        String address ='';
        for(Dumpsters__c dump : [SELECT Pdf_Parser_Delivery_Address__c,Copy_Dumpster_Address__c, Id, Name, GeoCode_Map__Latitude__s , GeoCode_Map__Longitude__s FROM Dumpsters__c where id =: newDumpIDSet]){
            
            if(dump.Pdf_Parser_Delivery_Address__c !=null)
            {
                address += dump.Pdf_Parser_Delivery_Address__c;
                address = EncodingUtil.urlEncode(address, 'UTF-8');
            }else{
                address += dump.Copy_Dumpster_Address__c;
                address = EncodingUtil.urlEncode(address, 'UTF-8');            
            }
            String geocodingKey = Label.Google_Map_API_Key;
            System.debug('address:'+address);
            
            
            Http h = new Http();
            HttpRequest req = new HttpRequest();
            // req.setEndpoint('https://maps.googleapis.com/maps/api/geocode/json?address='+'1600'+'Amphitheatre'+'Parkway,'+'Mountain'+'View,'+'CA'+'&key='+geocodingKey);
            req.setEndpoint('https://maps.googleapis.com/maps/api/geocode/json?address='+address+'&key='+geocodingKey+'&sensor=false');
            req.setMethod('GET');
            req.setTimeout(5000);
            try{
                JSONParser parser;
                HttpResponse res = new HttpResponse();
                if(Test.isRunningTest())
                {
                    string str=' {"results" : [      {         "formatted_address" : "6292 Montgomery Dr, San Antonio, TX 78239, USA",         "geometry" : {            "location" : {               "lat" : 29.511748,               "lng" : -98.36571049999999            },            "location_type" : "ROOFTOP",            "viewport" : {               "northeast" : {                  "lat" : 29.5130829302915,                  "lng" : -98.3642398697085               },               "southwest" : {                  "lat" : 29.5103849697085,                  "lng" : -98.3669378302915               }            }         },         "place_id" : "ChIJOcRh5TrzXIYRZTbWcKpfjTo",         "types" : [ "premise" ]      }   ],   "status" : "OK"}';
                    parser = JSON.createParser(str);
                }
                else
                {
                    res = h.send(req);
                    parser = JSON.createParser(res.getBody());
                }
                //  parse coordinates from response
                system.debug('Response is '+res.getBody());
                double lat = null;
                double lon = null;
                while (parser.nextToken() != null) {
                    
                    if ((parser.getCurrentToken() == JSONToken.FIELD_NAME) && (parser.getText() == 'location')){
                        parser.nextToken(); // object start
                        
                        while (parser.nextToken() != JSONToken.END_OBJECT){
                            
                            String txt = parser.getText();
                            
                            parser.nextToken();
                            
                            if (txt == 'lat'){
                                
                                lon= parser.getDoubleValue();
                                system.debug('lat is '+lon);
                            }
                            else if (txt == 'lng'){
                                
                                lat = parser.getDoubleValue();
                                system.debug('lon is '+lat);
                            }
                        }
                        
                    }
                    
                }
                
                // update coordinates if we get back
                if (lat != null){            
                    system.debug(lat+' '+lon);
                    dump.GeoCode_Map__Longitude__s= lat;
                    system.debug('dump.Geocodes__Longitude__s:'+dump.GeoCode_Map__Longitude__s);
                    dump.GeoCode_Map__Latitude__s = lon;
                    system.debug('dump.Geocodes__Longitude__s :'+dump.GeoCode_Map__Latitude__s );
                    update dump;
                }
            }
            catch (Exception e) {
                system.debug(e);
            }
        }
        
    } 
    
    
    public void updateCloneDumpsterComments(Map<id,Dumpsters__c> newdumMap)
    {
        set<Id> DumpsterIds = new set<Id>();
        List<Dumpsters__c> DumpsterUpdate = new List<Dumpsters__c>();
        
        for(Dumpsters__c DumpstersFor : newdumMap.values())
        {
            DumpsterIds.add(DumpstersFor.Id);
        }
        
        for(Dumpsters__c DumpstersFor : [Select id, Name, Comments__c, Is_Cloning__c from Dumpsters__c where id=: DumpsterIds])
        {
            Boolean updatedumpster = false;
            if(DumpstersFor.Comments__c.contains(Label.Full_at_Office))
            {
                String Commenthelper = DumpstersFor.Comments__c.substringAfter('HB').substringBefore(Label.Full_at_Office);
                system.debug(Commenthelper);
                DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('HB'+Commenthelper+Label.Full_at_Office,'');
                system.debug(DumpstersFor.Comments__c);
                updatedumpster = true;
            }
            
            
            if(DumpstersFor.Comments__c.contains(Label.Full_at_Office2))
            {
                String Commenthelper = DumpstersFor.Comments__c.substringAfter('HB').substringBefore(Label.Full_at_Office2);    
                system.debug(Commenthelper);
                DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('HB'+Commenthelper+Label.Full_at_Office2,'');
                system.debug(DumpstersFor.Comments__c);
                updatedumpster = true;
            }
            
            
            if(DumpstersFor.Comments__c.contains('pickup HB'))
            {
                String Commenthelper = DumpstersFor.Comments__c.substringAfter('pickup HB').substringBefore(',');
                system.debug(Commenthelper);
                DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('pickup HB'+Commenthelper+',','');
                system.debug(DumpstersFor.Comments__c);
                updatedumpster = true;
            }
            if(DumpstersFor.Comments__c.contains('More than one dumpster onsite,'))            // Else If added for Ticket 21394
            {
                String Commenthelper = DumpstersFor.Comments__c.substringAfter(', it should be ').substringBefore(',');
                String Commenthelper2 = DumpstersFor.Comments__c.substringAfter('More than one dumpster ').substringBefore('if it is not');
                system.debug(Commenthelper);
                if(Commenthelper2.containsignorecase('Warren'))
                    DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('More than one dumpster onsite, pickup the fullest dumpster, it should be '+Commenthelper+', let Warren know if it is not, so he can change the record.','');
                else
                    DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('More than one dumpster onsite, pickup the fullest dumpster, it should be '+Commenthelper+', let the dispatcher know if it is not, so he can change the record.','');
                system.debug(DumpstersFor.Comments__c);
                updatedumpster = true;
            }
            
            if(updatedumpster)
            {
                DumpsterUpdate.add(DumpstersFor);
            }
            
        }
        system.debug(DumpsterUpdate);
        if(DumpsterUpdate.size() > 0)
        {
            try
            {
                update DumpsterUpdate;
            }
            catch(Exception e)
            {
                system.debug('Exception raised due to :' + e);
            }
        }
    }
    
    public void relocationCommentRevert(Map<id,Dumpsters__c> newdumMap,Map<id,Dumpsters__c> OlddumMap )
    {
        set<Id> DumpsterIds = new set<Id>();
        List<Dumpsters__c> DumpsterUpdate = new List<Dumpsters__c>();
        
        for(Dumpsters__c DumpstersFor : newdumMap.values())
        {
            DumpsterIds.add(DumpstersFor.Id);
        }
        
        for(Dumpsters__c DumpstersFor : [Select id, Name,Status__c,Confirmed_Pick_Up_Date__c, Comments__c,RelocationComments__c, Is_Cloning__c from Dumpsters__c where id=: DumpsterIds])
        {
            system.debug('relocationCommentRevert');
            /*
if(DumpstersFor.Comments__c.contains(Label.Relocation_Label_1) && DumpstersFor.Comments__c.contains(Label.Relocation_Label_2))
{
String Commenthelper = DumpstersFor.Comments__c.substringAfter(Label.Relocation_Label_1).substringBefore(Label.Relocation_Label_2);
DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace(Label.Relocation_Label_1+Commenthelper+Label.Relocation_Label_1,'');
system.debug(DumpstersFor.Comments__c);

}
*/
            if(!((DumpstersFor.Status__c =='Drop Off Complete' && DumpstersFor.Comments__c.contains('<<COMPLETED'))||(DumpstersFor.Status__c =='Request for Pick-Up' && DumpstersFor.Comments__c.contains('<<COMPLETED'))) &&  DumpstersFor.Status__c !='Pick-up Scheduled' && DumpstersFor.Status__c !='Cycle Complete' )
            {
                
                if(DumpstersFor.Comments__c.contains('<<') && DumpstersFor.Comments__c.contains('>>'))
                {
                    String Commenthelper = DumpstersFor.Comments__c.substringAfter('<<').substringBefore('>>');
                    String CommentLochelper2 = DumpstersFor.Comments__c.substringAfter('<<').substringBefore('>>').substringAfter('RELOCATION ONLY  (').substringBefore(')');   
                    DumpstersFor.RelocationComments__c = CommentLochelper2;
                    system.debug(' DumpstersFor.Relocation_Comments__c222 >>> '+ DumpstersFor.RelocationComments__c);
                    
                    DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('<<'+Commenthelper+'>>','');
                    system.debug(DumpstersFor.Comments__c);
                    
                }
            }
            DumpsterUpdate.add(DumpstersFor);
            
        }
        
        if(DumpsterUpdate.size() > 0)
        {
            try
            {
                update DumpsterUpdate;
            }
            catch(Exception e)
            {
                system.debug('Exception raised due to Revert reloc comments:' + e);
            }
        }
        
    }
    
    public void request_Pickup_More_Dumpster(Map<id,Dumpsters__c> newDumps)
    {
        Map<String,Dumpsters__c> DumpsterAddress = new Map<String,Dumpsters__c>();
        Set<Id> NotmoreDumpsterAddress = new Set<Id>();
        Set<Id> DumpsterIds = new Set<Id>();
        List<Dumpsters__c> DumpsterUpdate = new List<Dumpsters__c>();
        
        for(Dumpsters__c DumpsterFor : newDumps.values())
        {
            if(DumpsterFor.Pdf_Parser_Delivery_Address__c != null)
                DumpsterAddress.put(DumpsterFor.Pdf_Parser_Delivery_Address__c,DumpsterFor);
        }
        system.debug('DumpsterAddress >>'+DumpsterAddress);
        for(AggregateResult ar : [Select count(Id) Ids, Pdf_Parser_Delivery_Address__c Address from Dumpsters__c where Pdf_Parser_Delivery_Address__c =: DumpsterAddress.keyset() and (Status__c = 'Drop Off Complete' or Status__c = 'Request for Pick-Up') group by Pdf_Parser_Delivery_Address__c])
        {
            system.debug('Ids>> '+(Integer)ar.get('Ids'));
            system.debug('Address >> '+(String)ar.get('Address'));
             system.debug('DumpsterAddress22 >>'+DumpsterAddress);
            if((Integer)ar.get('Ids') > 1)
            {
             system.debug(' <<Address >> '+(String)ar.get('Address'));
             system.debug('<<DumpsterAddress22 >>'+DumpsterAddress);
                system.debug(' 111111>>>11>  ');
                DumpsterIds.add(DumpsterAddress.get((String)ar.get('Address')).id);
                system.debug('DumpsterIds  >>>> '+DumpsterIds);
            }
            else if((Integer)ar.get('Ids') == 1)
            {    
                 system.debug(' 111111====11 ');
                NotmoreDumpsterAddress.add(DumpsterAddress.get((String)ar.get('Address')).id);
                system.debug('NotmoreDumpsterAddress>> '+NotmoreDumpsterAddress);
            }
        }
        system.debug('DumpsterIds>> '+DumpsterIds);
        if(DumpsterIds.size() > 0)
        {
            for(Dumpsters__c DumpstersFor : [Select id, Name, Comments__c, Container_Asset__r.Name from Dumpsters__c where id=: DumpsterIds])
            {
                String CommentUpdate = 'More than one dumpster onsite, pickup the fullest dumpster, it should be '+ DumpstersFor.Container_Asset__r.Name +', let the dispatcher know if it is not, so he can change the record.';
                if(DumpstersFor.Comments__c.contains('Pick Up Instructions:'))
                {
                    DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('Pick Up Instructions:','Pick Up Instructions: ' + CommentUpdate);
                }
                else if(DumpstersFor.Comments__c.contains('Pickup Instructions:'))
                {
                    DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('Pickup Instructions:','Pickup Instructions: ' + CommentUpdate);
                }
                DumpsterUpdate.add(DumpstersFor);
            }
        }
        
        system.debug('NotmoreDumpsterAddress>> >'+NotmoreDumpsterAddress);
        
        if(NotmoreDumpsterAddress.size() > 0)
        {
            for(Dumpsters__c DumpstersFor : [Select id, Name, Comments__c, Container_Asset__r.Name from Dumpsters__c where id=: NotmoreDumpsterAddress])
            {
                if(!DumpstersFor.Comments__c.contains('pickup HB'))
                {
                    if(DumpstersFor.Comments__c.contains('Pick Up Instructions:'))
                    {
                        DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('Pick Up Instructions:','Pick Up Instructions: ' + 'pickup '+DumpstersFor.Container_Asset__r.Name+',');
                    }
                    else if(DumpstersFor.Comments__c.contains('Pickup Instructions:'))
                    {
                        DumpstersFor.Comments__c = DumpstersFor.Comments__c.replace('Pickup Instructions:','Pickup Instructions: ' + 'pickup '+DumpstersFor.Container_Asset__r.Name+',');
                    }
                    DumpsterUpdate.add(DumpstersFor);
                }
            }
        }
        system.debug(DumpsterUpdate);
        if(DumpsterUpdate.size() > 0) 
        {
            try
            {
                update DumpsterUpdate;
            }
            catch(Exception e)
            {
                System.debug('Exception raised due to ' + e);
            }
        }
    }
    
    public void deleteDumpsterInvoice(Map<id,Dumpsters__c> newmap)
    {
        Set<id> dumpsterIds = new set<id>();
        list<Dumpster_Invoice__c> dumpsterinvoicedelete = new list<Dumpster_Invoice__c>();
        
        for(Dumpsters__c DumpsterFor : newmap.values())
        {
            if(Dumpsterfor.Final_Invoice_Number__c == 0 && Dumpsterfor.Status__c == 'Cycle Complete')
            {
                DumpsterIds.add(Dumpsterfor.id);
            }
        }
        
        for(Dumpster_Invoice__c DumpsterInvoiceFor : [Select id, Name, Dumpsters__c, Invoice_Pending_To_Approve__c from Dumpster_Invoice__c where RecordType.Name = 'Final Invoice' and Invoice_Pending_To_Approve__c != 'Approved' and Dumpsters__c = : DumpsterIds])
        {
            dumpsterinvoicedelete.add(DumpsterInvoiceFor);
        }
        
        If(dumpsterinvoicedelete.size()>0)
        {
            try
            {
                delete dumpsterinvoicedelete;
            }
            Catch(Exception e)
            {
                System.debug('Exception raised due to : ' + e);
            }
        }
    }
    
    /*----------------------------------------------------------------------------------------------------------------------------------*/   
    public void create_interim_invoice(Map<Id,Dumpsters__c> newdumMap )  //51360,53357
    {
        List<id> DumpsterIdList = new List<id>();  
        List<Dumpsters__c> DumpsterList = new List<Dumpsters__c>();
        Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();  
        List<Dumpster_Invoice__c> FinalDumpsterInvoiceList = new List<Dumpster_Invoice__c>(); 
        date d = System.today();
        string dat = d.format();     
        
        for(Dumpsters__c dumpster:[select id,AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c,AAccountccount__r.Tonnage_Quantity__c,Fill_Details__c,Pickup_Update_Request_Comments__c,Picked_Up_Date_Time__c,ExtraRentalDaysfor_Interim__c,Status__c ,Interim_Invoice__c,Concrete_Only__c,Haulbrooke_Regional_Base__c,Card_Run__c, Wait_Charge__c, Consolidate_Invoice__c,X10_Days_Rental_Up_Date__c, Dumpster_Rental_price__c,Interim_Invoices__c, Tonnage_Quantity__c, Initial_Invoice_Subtotal__c, Prohibited_Items__c,AAccountccount__c,Sales_Tax__c,Extra_Rental_DaysF__c,Additional_Tonnage_Quantity__c,Final_Invoice_Subtotal__c,Extra_Rental_Charge_Per_Day__c,Other_Charges__c,Dumpster_Weight__c,Per_Ton_Charge__c,initial_invoice_count__c,AAccountccount__r.Email_4__c,AAccountccount__r.Email_3__c,AAccountccount__r.Email_2__c,AAccountccount__r.Email_1__c,Final_invoice_count__c,Invoicing_Comments_Final__c from Dumpsters__c  where id=:newdumMap.keyset()]) 
        {
            
            if(dumpster.Interim_Invoices__c =='Create' || dumpster.Interim_Invoice__c == true)
            {
                
                DumpsterIdList.add(dumpster.id);
                Dumpster_Invoice__c DumpsterInvoice = new Dumpster_Invoice__c();
                DumpsterInvoice.Dumpsters__c        = dumpster.id;
                //DumpsterInvoice.Description__c      = 'Interim Invoice';      
                DumpsterInvoice.Invoice_Date__c     = System.today();
                DumpsterInvoice.Date_Due__c         = System.today();
                
                DumpsterInvoice.Customer_Email__c    = dumpster.AAccountccount__r.Email_1__c;
                DumpsterInvoice.Additional_Email__c  = dumpster.AAccountccount__r.Email_2__c;
                DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
                DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
                
                String Email1 = Label.Invoice_Email_1; 
                String Email2 = Label.Invoice_Email_2;
                
                String AccountId =dumpster.AAccountccount__c ;
                AccountId= AccountId.substring(0,AccountId.length()-3);
                
                if(Email1.Contains(AccountId ) || Test.isRunningTest())
                {
                    DumpsterInvoice.Customer_Email__c    = dumpster.AAccountccount__r.Email_1__c;
                    DumpsterInvoice.Additional_Email__c  = null;
                    DumpsterInvoice.Additional_Email2__c = null;
                    DumpsterInvoice.Additional_Email3__c = null;
                }
                
                if(Email2.Contains(AccountId ) || Test.isRunningTest())
                {
                    DumpsterInvoice.Customer_Email__c    = dumpster.AAccountccount__r.Email_2__c;
                    DumpsterInvoice.Additional_Email__c  = null; 
                    DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
                    DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
                }
                
                /*
if(dumpster.Interim_Invoice__c == true && dumpster.Consolidate_Invoice__c =='Yes' ) //53357  //||  !(olddumMap.get(dumpster.id).Interim_Invoices__c != dumpster.Interim_Invoices__c)) //&& (dumpster.Interim_Invoices__c == 'Create' && !(olddumMap.get(dumpster.id).Interim_Invoices__c != dumpster.Interim_Invoices__c))
{
DumpsterInvoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Consolidated Invoice').getRecordTypeId();

DumpsterInvoice.Description__c      = 'Dumpster Rental';
DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
DumpsterInvoice.Additional_Tonnage_Quantity__c  = Dumpster.Additional_Tonnage_Quantity__c;
DumpsterInvoice.Extra_Rental_Days__c            = Dumpster.Extra_Rental_DaysF__c;
DumpsterInvoice.Dumpster_Rental_price__c     = Dumpster.Dumpster_Rental_price__c;
DumpsterInvoice.Initial_Invoice_Subtotal__c  = Dumpster.Initial_Invoice_Subtotal__c;
DumpsterInvoice.Tonnage_Quantity__c             = Dumpster.Tonnage_Quantity__c;
}
else
{
*/
                DumpsterInvoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Final Invoice').getRecordTypeId();
                DumpsterInvoice.Extra_Rental_Days__c            = dumpster.ExtraRentalDaysfor_Interim__c;
                DumpsterInvoice.Invoicing_Comments__c  = 'Invoice only: '+dat+' ~Interim invoice raised for rental days to date.';
                DumpsterInvoice.Additional_Tonnage_Quantity__c  = 0.00;
                
                DumpsterInvoice.Description__c      = 'Interim Invoice';
                
                if(Dumpster.Haulbrooke_Regional_Base__c =='Houston' &&
                   Dumpster.Fill_Details__C =='Concrete Only' &&
                   Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c != NULL &&
                   Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c != 0 )
                {
                    DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c;  //51785
                }
                else
                {
                    DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
                }
                
                
                
                /*
if((olddumMap.get(dumpster.id).Status__c!= dumpster.Status__c) && dumpster.Status__c == 'Pick-Up Scheduled'  && !(olddumMap.get(dumpster.id).Interim_Invoices__c != dumpster.Interim_Invoices__c))
{
DumpsterInvoice.Extra_Rental_Days__c            = Dumpster.Extra_Rental_DaysF__c;

if(Dumpster.Additional_Tonnage_Quantity__c == 0.00)
{
DumpsterInvoice.Additional_Tonnage_Quantity__c = Dumpster.Dumpster_Weight__c - Dumpster.Tonnage_Quantity__c; 
}
else
{
DumpsterInvoice.Additional_Tonnage_Quantity__c  = Dumpster.Additional_Tonnage_Quantity__c;
}
system.debug('12232322-----------'+Dumpster.Additional_Tonnage_Quantity__c);
system.debug('1212121212121212121212-----------'+DumpsterInvoice.Additional_Tonnage_Quantity__c);
}
else
{

if(olddumMap.get(dumpster.id).Interim_Invoices__c != dumpster.Interim_Invoices__c && dumpster.Interim_Invoices__c == 'Create' )
{
DumpsterInvoice.Extra_Rental_Days__c            = dumpster.ExtraRentalDaysfor_Interim__c;
DumpsterInvoice.Additional_Tonnage_Quantity__c  = 0.00;
system.debug('1233333333333333333444444444443333333332-----------'+DumpsterInvoice.Additional_Tonnage_Quantity__c);
}

}

DumpsterInvoice.Description__c      = 'Interim Invoice';

if(Dumpster.Haulbrooke_Regional_Base__c =='Houston' &&
Dumpster.Concrete_Only__c =='Yes' &&
Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c != NULL &&
Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c != 0 )
{
DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c;  //51785
// Dumpster.Per_Ton_Charge__c   = Dumpster.AAccountccount__r.Concrete_Per_Ton_Charge_Houston__c; 
}
else
{
DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
}
*/
                // }
                
                
                DumpsterInvoice.Invoicing_Comments__c  = 'Invoice only: '+dat+' ~Interim invoice raised for rental days to date.';
                DumpsterInvoice.Other_Charges__c                = Dumpster.Other_Charges__c;
                                DumpsterInvoice.Dumpster_Weight__c                = Dumpster.Dumpster_Weight__c;

                DumpsterInvoice.Wait_Charge__c                  = Dumpster.Wait_Charge__c;
                DumpsterInvoice.Extra_Rental_Charge_Per_Day__c  = Dumpster.Extra_Rental_Charge_Per_Day__c;
                DumpsterInvoice.Final_Invoice_Subtotal__c       = Dumpster.Final_Invoice_Subtotal__c;
                DumpsterInvoice.Sales_Tax__c                    = Dumpster.Sales_Tax__c; 
                DumpsterInvoice.Account__c                      = Dumpster.AAccountccount__c;
                DumpsterInvoice.Prohibited_Items__c             = Dumpster.Prohibited_Items__c;
                DumpsterInvoice.Card_Run__c                     = Dumpster.Card_Run__c;
                
                FinalDumpsterInvoiceList.add(DumpsterInvoice);
                
            }
            
            if(dumpster.Interim_Invoices__c =='Create'  ) 
            {
                Dumpster.X10_Days_Rental_Up_Date__c = system.now(); 
                Dumpster.Interim_Invoice__c = true;
                system.debug('before - cmt 2>>>>>>>>>>> '+Dumpster.Pickup_Update_Request_Comments__c);
                if(Dumpster.Pickup_Update_Request_Comments__c!= null) //Dumpster.Pickup_Update_comment_Check__c == true  //Ticket -
                {
                    string cmt;
                    cmt = Dumpster.Pickup_Update_Request_Comments__c;
                    system.debug('cmt> '+cmt);
                    Dumpster.Pickup_Update_Request_Comments__c   =cmt+' , '+dat +'~interim inv~WB';
                    system.debug('cmt>>>>>>>>>>> '+Dumpster.Pickup_Update_Request_Comments__c);
                }
                else
                {    system.debug('else cmt >');
                 Dumpster.Pickup_Update_Request_Comments__c   = dat +'~interim inv~WB';
                }
                system.debug(' Dumpster.X10_Days_Rental_Up_Date__c >> ' + Dumpster.X10_Days_Rental_Up_Date__c);
                system.debug(' dumpster.Interim_Invoice__c >> ' + dumpster.Interim_Invoice__c);
                DumpsterList.add(Dumpster);
            }
            /* if(Dumpster.Interim_Invoicing_comments__c!=null)
{
// string cmt;
//cmt=dumpster.Interim_Invoicing_comments__c;
DumpsterInvoice.Invoicing_Comments__c =Dumpster.Interim_Invoicing_comments__c;

}*/
        }   
        if(FinalDumpsterInvoiceList.size()>0)
        {
            try
            {    
                update DumpsterList;
                system.debug('DumpsterList >> ' +DumpsterList);
                insert FinalDumpsterInvoiceList;
                
            }
            catch(exception e)
            {
                system.debug('Exception Raised Due to'+e);
            }   
        }
    }
    
    
    /*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Public void InvoicecommentUpdate(Map<id,Dumpsters__c> newDumpMap) //58817
    {
        set<id>DumpsterIds = new set<id>();
        list<Dumpster_Invoice__c> DumpsterInvlist = new list<Dumpster_Invoice__c>();
        
        for(Dumpsters__c dump : newDumpMap.values())
        {
            DumpsterIds.add(dump.id);    
        }   
        
        
        for(Dumpster_Invoice__c  DumpsterInvFor: [Select id, Name,Dumpsters__c, Invoicing_comments__c ,Dumpsters__r.Invoicing_Comments_Final__c,Description__c,Interim__c,Invoice_Pending_To_Approve__c, Update_Interim_Comments__c from Dumpster_Invoice__c where Dumpsters__c =:DumpsterIds and Invoice_Pending_To_Approve__c!= 'Approved' and Update_Interim_Comments__c!= True])
        {
            if((DumpsterInvFor.Dumpsters__r.Invoicing_Comments_Final__c!=null) && (DumpsterInvFor.Description__c =='Final Invoice')&&(DumpsterInvFor.Interim__c==True))
            {
                DumpsterInvFor.Invoicing_comments__c = DumpsterInvFor.Dumpsters__r.Invoicing_Comments_Final__c.remove('.') +'. '+ DumpsterInvFor.Invoicing_comments__c;
                
                DumpsterInvFor.Update_Interim_Comments__c = True;
            }
            DumpsterInvlist.add(DumpsterInvFor);
        }
        
        try
        {
            if(DumpsterInvlist.size()>0)
            {
                update DumpsterInvlist;
                
            }
        }
        catch(exception e)
        {
            system.debug('e>>>>>> '+e);
        }
    }
    
    
    
    public void create_new_dumpster(Map<Id,Dumpsters__c> newdumMap)
    {
        Set<id> DumpsterIdList = new Set<id>();  
        Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();  
        List<Dumpsters__c> FinalDumpsterList = new List<Dumpsters__c>();
        date Dropdate; date pickupdate;  
        for(Id DumpsterFor : newdumMap.keyset())
        {
            DumpsterIdList.add(DumpsterFor);
        }
        
        system.debug('test');
        for(Dumpsters__c DumpsterFor : Database.query('SELECT ' + String.join(new List<String>(Schema.getGlobalDescribe().get('Dumpsters__c').getDescribe().fields.getMap().keySet()), ',') + ' FROM Dumpsters__c where id =: DumpsterIdList'))
        { 
            
            Dumpsters__c Dumpsters = new Dumpsters__c();
            Dumpsters.AAccountccount__c = DumpsterFor.AAccountccount__c;
            Dumpsters.Gypsum_Only__c = DumpsterFor.Gypsum_Only__c;
            Dumpsters.Fill_Details__c= DumpsterFor.Fill_Details__c;
            Dumpsters.Comments__c = DumpsterFor.Comments_Helper__c;
            Dumpsters.Concrete_Only__c = DumpsterFor.Concrete_Only__c;
            Dumpsters.Contractor_Name_For_Gate__c = DumpsterFor.Contractor_Name_For_Gate__c;
            
            // Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Drop_Off_Visit_Date__c + 13;
            // Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c + 13;
            
            if(DumpsterFor.Confirmed_Pick_Up_Date__c !=null)
            {
                Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Confirmed_Pick_Up_Date__c ;
            }
            else
            {
                //Dropdate = system.today();
                Dropdate = DumpsterFor.Drop_Off_Visit_Date__c + 10;
                Datetime dtd = datetime.newInstance(Dropdate.year(), Dropdate.month(), Dropdate.day());
                system.debug( 'FormatCheck drop>> '+dtd.format('E'));
                string formatteddrop = dtd.format('E');
                system.debug( 'After formatted drop >> '+formatteddrop );
                
                if(formatteddrop == 'Sat')
                {
                    Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Drop_Off_Visit_Date__c + 12;
                }
                else if (formatteddrop == 'Sun')
                {
                    Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Drop_Off_Visit_Date__c + 11;
                }
                else
                {
                    Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Drop_Off_Visit_Date__c + 10;
                }
            }
            
            // pickupdate = system.today();
            pickupdate = Dumpsters.Drop_Off_Visit_Date__c + 10;
            Datetime dt = datetime.newInstance(pickupdate.year(), pickupdate.month(),pickupdate.day());
            system.debug( 'FormatCheck >> '+dt.format('E'));
            string formatted = dt.format('E');
            system.debug( 'After formatted >> '+formatted);
            
            if(formatted == 'Sat')
            {
                Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c + 12;
            }
            else if (formatted == 'Sun')
            {
                Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c + 11;
            }
            else
            {
                Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c + 10;
            }
            
            
            Dumpsters.Driver__c = DumpsterFor.Pick_Up_Driver__c;
            Dumpsters.Pdf_Parser_Delivery_Address__c = DumpsterFor.Pdf_Parser_Delivery_Address__c;
            Dumpsters.Dumpster_Rental_price__c = DumpsterFor.Dumpster_Rental_price__c;
            Dumpsters.Dumpster_Size__c = DumpsterFor.Dumpster_Size__c;
            Dumpsters.Estimated_GP__c = DumpsterFor.Estimated_GP__c;
            Dumpsters.Invoicing_Comments__c = DumpsterFor.Invoicing_Comments__c;
            Dumpsters.Metal_Only__c = DumpsterFor.Metal_Only__c;
            Dumpsters.Phone_Number_2__c = DumpsterFor.Phone_Number_2__c;
            Dumpsters.Phone_Number_22__c = DumpsterFor.Phone_Number_22__c;
            Dumpsters.Pick_Up_Driver__c = DumpsterFor.Pick_Up_Driver__c;
            Dumpsters.Proposal_Lost_Reason__c = DumpsterFor.Proposal_Lost_Reason__c;
            Dumpsters.Rental__c = DumpsterFor.Rental__c;
            Dumpsters.Status__c = 'Unscheduled';
            Dumpsters.Tonnage_Quantity__c = DumpsterFor.Tonnage_Quantity__c;
            Dumpsters.Wood_Only__c = DumpsterFor.Wood_Only__c;
            Dumpsters.Is_Cloning__c = true;
            
            FinalDumpsterList.add(Dumpsters);
            
        }  
        
        if(FinalDumpsterList.size()>0)
        {
            try
            {
                insert FinalDumpsterList;
            }
            catch(exception e)
            {
                system.debug('Exception Raised Due to'+e);
            }   
        }
    }   
    
    /*==================================18642=======================================================
*Method Name     : public void weekly_Consolidate_Invoice()
*Description     : Create and update Weekly Consolidate Invoice.
*Arguments       : To get a new values from Dumpster object.
===========================================================================================*/
    
    public void weekly_Consolidate_Invoice(Map<Id, Dumpsters__c> newDumpsterMap, Map<Id, Dumpsters__c> oldDumpsterMap)
    {
        
        Set<Id> DumpsterIds = new Set<Id>();
        Set<Id> AccountsId = new Set<Id>();
        Map<Id, Dumpsters__c> DumpstersMap = new Map<Id, Dumpsters__c>();
        Map<Id, Dumpster_Invoice__c> AccountDumpstersInvoiceId = new Map<Id, Dumpster_Invoice__c>();
        Map<Id, Dumpster_Invoice__c> ConcreteDumpstersInvoiceId = new Map<Id, Dumpster_Invoice__c>();
        Map<Id, Dumpster_Invoice__c> WoodDumpstersInvoiceId = new Map<Id, Dumpster_Invoice__c>();
        Map<Id, Dumpster_Invoice__c> PlasticDumpstersInvoiceId = new Map<Id, Dumpster_Invoice__c>();
        Map<Id, Dumpster_Invoice__c> MetalDumpstersInvoiceId = new Map<Id, Dumpster_Invoice__c>();
        Map<Id, Dumpster_Invoice__c> AsbestosDumpstersInvoiceId = new Map<Id, Dumpster_Invoice__c>();
        List<Dumpster_Invoice__c> Dumpsters_InvoiceUpsert = new List<Dumpster_Invoice__c>();
        
        for(Dumpsters__c DumpsterIdFor : newDumpsterMap.values())
        {
            DumpsterIds.add(DumpsterIdFor.Id);
        }
        
        for(Dumpsters__c DumpsterFor : [select id,initial_invoice_count__c,Concrete_Only__c,Fill_Details__c,Wood_Only__c,Metal_Only__c,Gypsum_Only__c,Final_invoice_count__c,Card_Run__c, Prohibited_Items__c,Consolidate_Invoice__c,name,AAccountccount__r.Consolidated_Invoice__c,Status__c,Dumpster_Size__c,Sales_Tax__c,Extra_Rental_Charge_Per_Day__c ,Dumpster_Rental_Price__c ,Per_Ton_Charge__c ,AAccountccount__c,AAccountccount__r.Email_1__c,AAccountccount__r.Email_2__c,AAccountccount__r.Email_3__c,AAccountccount__r.Email_4__c,Initial_Invoice_Subtotal__c,Other_Charges__c,Dumpster_Weight__c,Wait_Charge__c,Final_Invoice_Subtotal__c,Tonnage_Quantity__c,Additional_Tonnage_Quantity__c,Extra_Rental_DaysF__c,Rental__c,Initial_Invoice_Number__c,Final_Invoice_Number__c from Dumpsters__c where Id =: DumpsterIds and Final_Invoice_Number__c != 0])
        {
            DumpstersMap.put(DumpsterFor.Id, DumpsterFor);
            AccountsId.add(DumpsterFor.AAccountccount__c);
        }
        
        for(Dumpster_Invoice__c Dumpsters_InvoiceFor : [Select id, Name, Dumpsters__r.Concrete_Only__c, Dumpsters__r.Fill_Details__c,Dumpsters__r.Wood_Only__c, Dumpsters__r.Metal_Only__c, Dumpsters__r.Gypsum_Only__c, Dumpsters__c, Account__c, Other_Charges__c,Dumpster_Weight__c, Tonnage_Quantity__c, Extra_Rental_Days__c, Dumpster_Rental_price__c, Weekly_Consolidate_Invoice__c, Wait_Charge__c, Prohibited_Items__c, Additional_Tonnage_Quantity__c from Dumpster_Invoice__c where Account__c =: AccountsId and Createddate = THIS_WEEK and Dumpsters__r.Weekly_Consolidate_Invoice__c = 'Yes' and Invoice_Pending_To_Approve__c != 'Approved'])
        {
            if(Dumpsters_InvoiceFor.Dumpsters__r.Fill_Details__c == 'Concrete Only')
            {
                ConcreteDumpstersInvoiceId.put(Dumpsters_InvoiceFor.Account__c, Dumpsters_InvoiceFor);
            }
            else if(Dumpsters_InvoiceFor.Dumpsters__r.Fill_Details__c == 'Wood Only')
            {
                WoodDumpstersInvoiceId.put(Dumpsters_InvoiceFor.Account__c, Dumpsters_InvoiceFor);
            }
            else if(Dumpsters_InvoiceFor.Dumpsters__r.Fill_Details__c == 'Metal Only')
            {
                MetalDumpstersInvoiceId.put(Dumpsters_InvoiceFor.Account__c, Dumpsters_InvoiceFor);
            }
            else if(Dumpsters_InvoiceFor.Dumpsters__r.Fill_Details__c == 'Cardboard/Plastic Only')
            {
                PlasticDumpstersInvoiceId.put(Dumpsters_InvoiceFor.Account__c, Dumpsters_InvoiceFor);
            }
            else if(Dumpsters_InvoiceFor.Dumpsters__r.Fill_Details__c == 'Asbestos Only')
            {
                AsbestosDumpstersInvoiceId.put(Dumpsters_InvoiceFor.Account__c, Dumpsters_InvoiceFor);
            }
            else
            {
                AccountDumpstersInvoiceId.put(Dumpsters_InvoiceFor.Account__c, Dumpsters_InvoiceFor);
            }
            
        }
        system.debug(AccountDumpstersInvoiceId);
        try
        {
            for(Dumpsters__c DumpsterFor : DumpstersMap.values())
            {
                String AccountCheck;
                
                if(DumpsterFor.Fill_Details__c == 'Concrete Only')    
                AccountCheck = 'Concrete';
                else if(DumpsterFor.Fill_Details__c == 'Wood Only')    
                AccountCheck = 'Wood';
                else if(DumpsterFor.Fill_Details__c == 'Metal Only')    
                AccountCheck = 'Metal';
                else if(DumpsterFor.Fill_Details__c == 'Cardboard/Plastic Only')    
                AccountCheck = 'Plastic';
                else if(DumpsterFor.Fill_Details__c == 'Asbestos Only')    
                AccountCheck = 'Asbestos';
                else   
                AccountCheck = 'General';
                
                system.debug('AccountCheck >> '+AccountCheck);
                
                if((AccountCheck == 'General' && AccountDumpstersInvoiceId.containskey(DumpsterFor.AAccountccount__c)) || (AccountCheck == 'Concrete' && ConcreteDumpstersInvoiceId.containskey(DumpsterFor.AAccountccount__c)) || (AccountCheck == 'Wood' && WoodDumpstersInvoiceId.containskey(DumpsterFor.AAccountccount__c)) || (AccountCheck == 'Metal' && MetalDumpstersInvoiceId.containskey(DumpsterFor.AAccountccount__c)) || (AccountCheck == 'Plastic' && PlasticDumpstersInvoiceId.containskey(DumpsterFor.AAccountccount__c)) || (AccountCheck == 'Asbestos' && AsbestosDumpstersInvoiceId.containskey(DumpsterFor.AAccountccount__c)))
                {
                    system.debug('Inside If >>');
                    if((AccountCheck == 'General' && !AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c.contains(DumpsterFor.Name)) || (AccountCheck == 'Concrete' && !ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c.contains(DumpsterFor.Name)) || (AccountCheck == 'Wood' && !WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c.contains(DumpsterFor.Name)) || (AccountCheck == 'Metal' && !MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c.contains(DumpsterFor.Name)) || (AccountCheck == 'Plastic' && !PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c.contains(DumpsterFor.Name)) || (AccountCheck == 'Asbestos' && !AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c.contains(DumpsterFor.Name)))
                    {
                        system.debug('Inside If If>>');
                        if(DumpsterFor.Fill_Details__c == 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpsters__c = DumpsterFor.Id;
                        else if(DumpsterFor.Fill_Details__c == 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpsters__c = DumpsterFor.Id;
                        else if(DumpsterFor.Fill_Details__c == 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpsters__c = DumpsterFor.Id;
                        else if(DumpsterFor.Fill_Details__c == 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpsters__c = DumpsterFor.Id;
                        else if(DumpsterFor.Fill_Details__c == 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpsters__c = DumpsterFor.Id;
                        else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpsters__c = DumpsterFor.Id;
                        
                        
                        if(DumpsterFor.Dumpster_Rental_price__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c == 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + DumpsterFor.Dumpster_Rental_price__c : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c == 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + DumpsterFor.Dumpster_Rental_price__c : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c == 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + DumpsterFor.Dumpster_Rental_price__c : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c == 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + DumpsterFor.Dumpster_Rental_price__c : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c == 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + DumpsterFor.Dumpster_Rental_price__c : DumpsterFor.Dumpster_Rental_price__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + DumpsterFor.Dumpster_Rental_price__c : DumpsterFor.Dumpster_Rental_price__c;
                        }
                        
                        if(DumpsterFor.Tonnage_Quantity__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c == 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + DumpsterFor.Tonnage_Quantity__c : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c == 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + DumpsterFor.Tonnage_Quantity__c : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c == 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + DumpsterFor.Tonnage_Quantity__c : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c == 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + DumpsterFor.Tonnage_Quantity__c : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c == 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + DumpsterFor.Tonnage_Quantity__c : DumpsterFor.Tonnage_Quantity__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + DumpsterFor.Tonnage_Quantity__c : DumpsterFor.Tonnage_Quantity__c;
                        }
                        
                        if(DumpsterFor.Extra_Rental_DaysF__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c == 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + DumpsterFor.Extra_Rental_DaysF__c : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c == 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + DumpsterFor.Extra_Rental_DaysF__c : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c == 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + DumpsterFor.Extra_Rental_DaysF__c : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c == 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + DumpsterFor.Extra_Rental_DaysF__c : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c == 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + DumpsterFor.Extra_Rental_DaysF__c : DumpsterFor.Extra_Rental_DaysF__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + DumpsterFor.Extra_Rental_DaysF__c: DumpsterFor.Extra_Rental_DaysF__c;
                        }
                        
                        if(DumpsterFor.Additional_Tonnage_Quantity__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + DumpsterFor.Additional_Tonnage_Quantity__c : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + DumpsterFor.Additional_Tonnage_Quantity__c : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + DumpsterFor.Additional_Tonnage_Quantity__c : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + DumpsterFor.Additional_Tonnage_Quantity__c : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + DumpsterFor.Additional_Tonnage_Quantity__c : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + DumpsterFor.Additional_Tonnage_Quantity__c : DumpsterFor.Additional_Tonnage_Quantity__c;
                        }
                        
                        if(DumpsterFor.Prohibited_Items__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + DumpsterFor.Prohibited_Items__c : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + DumpsterFor.Prohibited_Items__c : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + DumpsterFor.Prohibited_Items__c : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + DumpsterFor.Prohibited_Items__c : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + DumpsterFor.Prohibited_Items__c : DumpsterFor.Prohibited_Items__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + DumpsterFor.Prohibited_Items__c : DumpsterFor.Prohibited_Items__c;
                        }
                        
                        if(DumpsterFor.Wait_Charge__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c == 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + DumpsterFor.Wait_Charge__c : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + DumpsterFor.Wait_Charge__c : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + DumpsterFor.Wait_Charge__c : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + DumpsterFor.Wait_Charge__c : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + DumpsterFor.Wait_Charge__c : DumpsterFor.Wait_Charge__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + DumpsterFor.Wait_Charge__c : DumpsterFor.Wait_Charge__c;
                        }
                        
                        if(DumpsterFor.Other_Charges__c != null)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + DumpsterFor.Other_Charges__c : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + DumpsterFor.Other_Charges__c : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + DumpsterFor.Other_Charges__c : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + DumpsterFor.Other_Charges__c : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + DumpsterFor.Other_Charges__c : DumpsterFor.Other_Charges__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + DumpsterFor.Other_Charges__c : DumpsterFor.Other_Charges__c;
                        }
                        /*
                        if(DumpsterFor.Dumpster_Weight__c != null)
                        {
                        
                          AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Weight__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Weight__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Weight__c + DumpsterFor.Dumpster_Weight__c :  DumpsterFor.Dumpster_Weight__c ;
                        }
                        */
                        
                        if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c + ' - ' + DumpsterFor.Name : DumpsterFor.Name;
                        else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c + ' - ' + DumpsterFor.Name : DumpsterFor.Name;
                        else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c + ' - ' + DumpsterFor.Name : DumpsterFor.Name;
                        else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c + ' - ' + DumpsterFor.Name : DumpsterFor.Name;
                        else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c + ' - ' + DumpsterFor.Name : DumpsterFor.Name;
                        else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Weekly_Consolidate_Invoice__c + ' - ' + DumpsterFor.Name : DumpsterFor.Name;
                       
                        if(DumpsterFor.Fill_Details__c== 'Concrete Only')    Dumpsters_InvoiceUpsert.add(ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c== 'Wood Only')    Dumpsters_InvoiceUpsert.add(WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c== 'Metal Only')    Dumpsters_InvoiceUpsert.add(MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    Dumpsters_InvoiceUpsert.add(PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    Dumpsters_InvoiceUpsert.add(AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else    Dumpsters_InvoiceUpsert.add(AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                    }
                    else
                    {
                        system.debug('Inside If If else');
                        
                        if(DumpsterFor.Dumpster_Rental_price__c != oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + ((DumpsterFor.Dumpster_Rental_price__c != null ? DumpsterFor.Dumpster_Rental_price__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c : 0)) : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + ((DumpsterFor.Dumpster_Rental_price__c != null ? DumpsterFor.Dumpster_Rental_price__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c : 0)) : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + ((DumpsterFor.Dumpster_Rental_price__c != null ? DumpsterFor.Dumpster_Rental_price__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c : 0)) : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + ((DumpsterFor.Dumpster_Rental_price__c != null ? DumpsterFor.Dumpster_Rental_price__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c : 0)) : DumpsterFor.Dumpster_Rental_price__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + ((DumpsterFor.Dumpster_Rental_price__c != null ? DumpsterFor.Dumpster_Rental_price__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c : 0)) : DumpsterFor.Dumpster_Rental_price__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Rental_price__c + ((DumpsterFor.Dumpster_Rental_price__c != null ? DumpsterFor.Dumpster_Rental_price__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Rental_price__c : 0)) : DumpsterFor.Dumpster_Rental_price__c;
                        }
                        
                        if(DumpsterFor.Tonnage_Quantity__c != oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + ((DumpsterFor.Tonnage_Quantity__c != null ? DumpsterFor.Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c : 0)) : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + ((DumpsterFor.Tonnage_Quantity__c != null ? DumpsterFor.Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c : 0)) : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + ((DumpsterFor.Tonnage_Quantity__c != null ? DumpsterFor.Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c : 0)) : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + ((DumpsterFor.Tonnage_Quantity__c != null ? DumpsterFor.Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c : 0)) : DumpsterFor.Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + ((DumpsterFor.Tonnage_Quantity__c != null ? DumpsterFor.Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c : 0)) : DumpsterFor.Tonnage_Quantity__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Tonnage_Quantity__c + ((DumpsterFor.Tonnage_Quantity__c != null ? DumpsterFor.Tonnage_Quantity__c : 0 )- (oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Tonnage_Quantity__c : 0)) : DumpsterFor.Tonnage_Quantity__c;
                        }
                        if(DumpsterFor.Extra_Rental_DaysF__c != oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + ((DumpsterFor.Extra_Rental_DaysF__c != null ? DumpsterFor.Extra_Rental_DaysF__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c : 0)) : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + ((DumpsterFor.Extra_Rental_DaysF__c != null ? DumpsterFor.Extra_Rental_DaysF__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c : 0)) : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + ((DumpsterFor.Extra_Rental_DaysF__c != null ? DumpsterFor.Extra_Rental_DaysF__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c : 0)) : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + ((DumpsterFor.Extra_Rental_DaysF__c != null ? DumpsterFor.Extra_Rental_DaysF__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c : 0)) : DumpsterFor.Extra_Rental_DaysF__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + ((DumpsterFor.Extra_Rental_DaysF__c != null ? DumpsterFor.Extra_Rental_DaysF__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c : 0)) : DumpsterFor.Extra_Rental_DaysF__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Extra_Rental_Days__c + ((DumpsterFor.Extra_Rental_DaysF__c != null ? DumpsterFor.Extra_Rental_DaysF__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Extra_Rental_DaysF__c : 0)) : DumpsterFor.Extra_Rental_DaysF__c;
                        }
                        
                        if(DumpsterFor.Additional_Tonnage_Quantity__c != oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + ((DumpsterFor.Additional_Tonnage_Quantity__c != null ? DumpsterFor.Additional_Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c : 0)) : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + ((DumpsterFor.Additional_Tonnage_Quantity__c != null ? DumpsterFor.Additional_Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c : 0)) : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + ((DumpsterFor.Additional_Tonnage_Quantity__c != null ? DumpsterFor.Additional_Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c : 0)) : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + ((DumpsterFor.Additional_Tonnage_Quantity__c != null ? DumpsterFor.Additional_Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c : 0)) : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + ((DumpsterFor.Additional_Tonnage_Quantity__c != null ? DumpsterFor.Additional_Tonnage_Quantity__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c : 0)) : DumpsterFor.Additional_Tonnage_Quantity__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Additional_Tonnage_Quantity__c + ((DumpsterFor.Additional_Tonnage_Quantity__c != null ? DumpsterFor.Additional_Tonnage_Quantity__c : 0 )- (oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Additional_Tonnage_Quantity__c : 0)) : DumpsterFor.Additional_Tonnage_Quantity__c;
                        }
                        
                        if(DumpsterFor.Prohibited_Items__c != oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + ((DumpsterFor.Prohibited_Items__c != null ? DumpsterFor.Prohibited_Items__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c : 0)) : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + ((DumpsterFor.Prohibited_Items__c != null ? DumpsterFor.Prohibited_Items__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c : 0)) : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + ((DumpsterFor.Prohibited_Items__c != null ? DumpsterFor.Prohibited_Items__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c : 0)) : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + ((DumpsterFor.Prohibited_Items__c != null ? DumpsterFor.Prohibited_Items__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c : 0)) : DumpsterFor.Prohibited_Items__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + ((DumpsterFor.Prohibited_Items__c != null ? DumpsterFor.Prohibited_Items__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c : 0)) : DumpsterFor.Prohibited_Items__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Prohibited_Items__c + ((DumpsterFor.Prohibited_Items__c !=null ? DumpsterFor.Prohibited_Items__c : 0 )- (oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Prohibited_Items__c : 0)) : DumpsterFor.Prohibited_Items__c;
                        }
                        
                        if(DumpsterFor.Wait_Charge__c != oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + ((DumpsterFor.Wait_Charge__c != null ? DumpsterFor.Wait_Charge__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c : 0)) : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + ((DumpsterFor.Wait_Charge__c != null ? DumpsterFor.Wait_Charge__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c : 0)) : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + ((DumpsterFor.Wait_Charge__c != null ? DumpsterFor.Wait_Charge__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c : 0)) : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + ((DumpsterFor.Wait_Charge__c != null ? DumpsterFor.Wait_Charge__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c : 0)) : DumpsterFor.Wait_Charge__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + ((DumpsterFor.Wait_Charge__c != null ? DumpsterFor.Wait_Charge__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c : 0)) : DumpsterFor.Wait_Charge__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Wait_Charge__c + ((DumpsterFor.Wait_Charge__c != null ? DumpsterFor.Wait_Charge__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Wait_Charge__c : 0)) : DumpsterFor.Wait_Charge__c;
                        }
                        
                        if(DumpsterFor.Other_Charges__c != oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c)
                        {
                            if(DumpsterFor.Fill_Details__c== 'Concrete Only')    ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + ((DumpsterFor.Other_Charges__c != null ? DumpsterFor.Other_Charges__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c : 0)) : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Wood Only')    WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + ((DumpsterFor.Other_Charges__c != null ? DumpsterFor.Other_Charges__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c : 0)) : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Metal Only')    MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + ((DumpsterFor.Other_Charges__c != null ? DumpsterFor.Other_Charges__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c : 0)) : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + ((DumpsterFor.Other_Charges__c != null ? DumpsterFor.Other_Charges__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c : 0)) : DumpsterFor.Other_Charges__c;
                            else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + ((DumpsterFor.Other_Charges__c != null ? DumpsterFor.Other_Charges__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c : 0)) : DumpsterFor.Other_Charges__c;
                            else    AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Other_Charges__c + ((DumpsterFor.Other_Charges__c != null ? DumpsterFor.Other_Charges__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Other_Charges__c : 0)) : DumpsterFor.Other_Charges__c;
                        }
                     /*   if(DumpsterFor.Dumpster_Weight__c!= oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Weight__c)
                        {
                                AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Weight__c = AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Weight__c != null ? AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c).Dumpster_Weight__c + ((DumpsterFor.Dumpster_Weight__c != null ? DumpsterFor.Dumpster_Weight__c : 0) - (oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Weight__c!= null ? oldDumpsterMap.get(DumpsterFor.Id).Dumpster_Weight__c : 0)) : DumpsterFor.Dumpster_Weight__c;
                        }*/
                        if(DumpsterFor.Fill_Details__c== 'Concrete Only')    Dumpsters_InvoiceUpsert.add(ConcreteDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c== 'Wood Only')    Dumpsters_InvoiceUpsert.add(WoodDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c== 'Metal Only')    Dumpsters_InvoiceUpsert.add(MetalDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c == 'Cardboard/Plastic Only')    Dumpsters_InvoiceUpsert.add(PlasticDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else if(DumpsterFor.Fill_Details__c == 'Asbestos Only')    Dumpsters_InvoiceUpsert.add(AsbestosDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                        else    Dumpsters_InvoiceUpsert.add(AccountDumpstersInvoiceId.get(DumpsterFor.AAccountccount__c));
                    }
                }
                else
                {
                    system.debug('ELse part >>>');
                        
                    Dumpster_Invoice__c Dumpster_Invoice = new Dumpster_Invoice__c();
                    Dumpster_Invoice.Dumpsters__c = DumpsterFor.Id;
                    Dumpster_Invoice.Account__c = DumpsterFor.AAccountccount__c;
                    Dumpster_Invoice.Description__c      = 'Dumpster Rental';
                    Dumpster_Invoice.Invoice_Date__c     = System.today();
                    Dumpster_Invoice.Date_Due__c         = System.today();
                    
                    Dumpster_Invoice.Customer_Email__c    = DumpsterFor.AAccountccount__r.Email_1__c;
                    Dumpster_Invoice.Additional_Email__c  = DumpsterFor.AAccountccount__r.Email_2__c;
                    Dumpster_Invoice.Additional_Email2__c = DumpsterFor.AAccountccount__r.Email_3__c;
                    Dumpster_Invoice.Additional_Email3__c = DumpsterFor.AAccountccount__r.Email_4__c;
                    
                    String Email1 = Label.Invoice_Email_1; 
                    String Email2 = Label.Invoice_Email_2;
                    
                    String AccountId =DumpsterFor.AAccountccount__c ;
                    AccountId= AccountId.substring(0,AccountId.length()-3);
                    
                    if(Email1.Contains(AccountId ) || Test.isRunningTest())
                    {
                        Dumpster_Invoice.Customer_Email__c    = DumpsterFor.AAccountccount__r.Email_1__c;
                        Dumpster_Invoice.Additional_Email__c  = null;
                        Dumpster_Invoice.Additional_Email2__c = null;
                        Dumpster_Invoice.Additional_Email3__c = null;
                    }
                    
                    if(Email2.Contains(AccountId ) || Test.isRunningTest())
                    {
                        Dumpster_Invoice.Customer_Email__c    = DumpsterFor.AAccountccount__r.Email_2__c;
                        Dumpster_Invoice.Additional_Email__c  = null; 
                        Dumpster_Invoice.Additional_Email2__c = DumpsterFor.AAccountccount__r.Email_3__c;
                        Dumpster_Invoice.Additional_Email3__c = DumpsterFor.AAccountccount__r.Email_4__c;
                    }
                    
                    Dumpster_Invoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Consolidated Invoice').getRecordTypeId();
                    Dumpster_Invoice.Per_Ton_Charge__c   = DumpsterFor.Per_Ton_Charge__c;
                    Dumpster_Invoice.Tonnage_Quantity__c             = DumpsterFor.Tonnage_Quantity__c;
                    Dumpster_Invoice.Dumpster_Rental_price__c     = DumpsterFor.Dumpster_Rental_price__c;
                    Dumpster_Invoice.Dumpster_Weight__c             = DumpsterFor.Dumpster_Weight__c;
                    Dumpster_Invoice.Other_Charges__c             = DumpsterFor.Other_Charges__c;
                    Dumpster_Invoice.Wait_Charge__c      = DumpsterFor.Wait_Charge__c;
                    Dumpster_Invoice.Extra_Rental_Charge_Per_Day__c  = DumpsterFor.Extra_Rental_Charge_Per_Day__c;
                    Dumpster_Invoice.Final_Invoice_Subtotal__c       = DumpsterFor.Final_Invoice_Subtotal__c;
                    Dumpster_Invoice.Additional_Tonnage_Quantity__c  = DumpsterFor.Additional_Tonnage_Quantity__c;
                    Dumpster_Invoice.Extra_Rental_Days__c            = DumpsterFor.Extra_Rental_DaysF__c;
                    Dumpster_Invoice.Sales_Tax__c                    = DumpsterFor.Sales_Tax__c; 
                    Dumpster_Invoice.Account__c                      = DumpsterFor.AAccountccount__c;
                    Dumpster_Invoice.Prohibited_Items__c             = DumpsterFor.Prohibited_Items__c;
                    Dumpster_Invoice.Card_Run__c                     = DumpsterFor.Card_Run__c;
                    Dumpster_Invoice.Weekly_Consolidate_Invoice__c = DumpsterFor.Name;
                    
                    if(DumpsterFor.Fill_Details__c == 'Concrete Only')    Dumpster_Invoice.Weekly_Invoice_Type__c = 'Concrete Weekly Invoice';
                    else if(DumpsterFor.Fill_Details__c == 'Wood Only')    Dumpster_Invoice.Weekly_Invoice_Type__c = 'Wood Weekly Invoice';
                    else if(DumpsterFor.Fill_Details__c== 'Metal Only')    Dumpster_Invoice.Weekly_Invoice_Type__c = 'Metal Weekly Invoice';
                    else if(DumpsterFor.Fill_Details__c== 'Cardboard/Plastic Only')    Dumpster_Invoice.Weekly_Invoice_Type__c = 'Cardboard / Plastic Weekly Invoice';
                    else if(DumpsterFor.Fill_Details__c== 'Asbestos Only')    Dumpster_Invoice.Weekly_Invoice_Type__c = 'Asbestos Only Weekly Invoice';
                    else    Dumpster_Invoice.Weekly_Invoice_Type__c = 'General Debris Weekly Invoice';
                    
                    Dumpsters_InvoiceUpsert.add(Dumpster_Invoice);
                }
            }
            system.debug(Dumpsters_InvoiceUpsert);
            if(Dumpsters_InvoiceUpsert.size() >0)
            {
                system.debug('upsert >>>');
                upsert Dumpsters_InvoiceUpsert;
            }
            
        }
        catch(Exception e)
        {
            System.debug('>>>excep '+e);
        }
    }
    
    public void createnewdumpsterafterpickup(Map<id, Dumpsters__c> newmap)
    {
        List<Dumpsters__c> DumpstersInsert = new List<Dumpsters__c>();
        Set<Id> DumpsterId = new Set<Id>();
        Set<Id> AccountId = new Set<Id>();
        Map<id, String> DumpsterPurchaseOrder = new Map<id, String>();
        
        for(Dumpsters__c DumpsterFor : newmap.values())
        {
            DumpsterId.add(DumpsterFor.Id);
            AccountId.add(DumpsterFor.AAccountccount__c);
        }
        
        for(Account Accountfor : [Select Id, (Select AAccountccount__c, Purchase_Order__c from Dumpsters__r order by createddate desc Limit 1) from Account where Id =:AccountId])
        {
            Dumpsters__c Dumpster = Accountfor.Dumpsters__r;
            DumpsterPurchaseOrder.put(Dumpster.AAccountccount__c, Dumpster.Purchase_Order__c);
        }
        
        system.debug(DumpsterPurchaseOrder);
        
        for(Dumpsters__c DumpsterFor : Database.query('SELECT ' + String.join(new List<String>(Schema.getGlobalDescribe().get('Dumpsters__c').getDescribe().fields.getMap().keySet()), ',') + ' FROM Dumpsters__c where id =: DumpsterId'))
        {
            Dumpsters__c Dumpsters = new Dumpsters__c();
            Dumpsters.AAccountccount__c = DumpsterFor.AAccountccount__c;
            Dumpsters.Gypsum_Only__c = null;
            //Dumpsters.Comments__c = DumpsterFor.Comments_Helper__c;
            Dumpsters.Concrete_Only__c = null;
            Dumpsters.Contractor_Name_For_Gate__c = DumpsterFor.Contractor_Name_For_Gate__c;
            Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Confirmed_Pick_Up_Date__c;
            Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c;
            Dumpsters.Driver__c = DumpsterFor.Pick_Up_Driver__c;
            Dumpsters.Pdf_Parser_Delivery_Address__c = DumpsterFor.Pdf_Parser_Delivery_Address__c;
            Dumpsters.DifferentDriverSameAddress__c = true;
            Dumpsters.Dumpster_Size__c = DumpsterFor.Dumpster_Size__c;
            Dumpsters.Estimated_GP__c = DumpsterFor.Estimated_GP__c;
            //Dumpsters.Invoicing_Comments__c = DumpsterFor.Invoicing_Comments__c;
            Dumpsters.Metal_Only__c = null;
            Dumpsters.Phone_Number_2__c = DumpsterFor.Phone_Number_2__c;
            Dumpsters.Phone_Number_22__c = DumpsterFor.Phone_Number_22__c;
            Dumpsters.Pick_Up_Driver__c = DumpsterFor.Pick_Up_Driver__c;
            Dumpsters.Proposal_Lost_Reason__c = DumpsterFor.Proposal_Lost_Reason__c;
            Dumpsters.Rental__c = DumpsterFor.Rental__c;
            Dumpsters.Status__c = 'Unscheduled';
            Dumpsters.Tonnage_Quantity__c = DumpsterFor.Tonnage_Quantity__c;
            Dumpsters.Wood_Only__c = null;
            Dumpsters.Fill_Details__c = null;
            Dumpsters.Is_Cloning__c = true;
            try
            {
                if(DumpsterPurchaseOrder.containskey(DumpsterFor.AAccountccount__c))
                {
                    Dumpsters.Purchase_Order__c = DumpsterPurchaseOrder.get(DumpsterFor.AAccountccount__c).substringBefore('-') + '-' + String.valueOf(Integer.valueOf(DumpsterPurchaseOrder.get(DumpsterFor.AAccountccount__c).substringAfter('-'))+1);
                }
            }
            catch(Exception e)
            {
                System.debug('Exception raised due to ' + e);
            }
            DumpstersInsert.add(Dumpsters);
        }
        
        if(DumpstersInsert.size() > 0)
        {
            try
            {
             
                if(test.isRunningTest())
                {
                    
                }
                else
                {
                    insert DumpstersInsert;
                }
                
            }
            catch(Exception e)
            {
                System.debug('Exception raised due to ' + e);
            }
        }
    }
    
    /*==================================62217=======================================================
*Method Name     : public void createnewdumpsterafterdropoff()
*Description     : Create new dumpster when we set again the Dropoff.
*Arguments       : To get a new values from Dumpster object.
===========================================================================================*/
    
    
    public void createnewdumpsterafterdropoff(Map<id, Dumpsters__c> newmap)
    {
        
        system.debug('createnewdumpsterafterdropoff >>>');
        
        List<Dumpsters__c> DumpstersInsert = new List<Dumpsters__c>();
        List<Dumpsters__c> DumpstersUpdate = new List<Dumpsters__c>();
        Set<Id> DumpsterId = new Set<Id>();
        Set<Id> AccountId = new Set<Id>();
        date dropdate;
        
        Map<id, String> DumpsterPurchaseOrder = new Map<id, String>();
        
        for(Dumpsters__c DumpsterFor : newmap.values())
        {
            DumpsterId.add(DumpsterFor.Id);
            AccountId.add(DumpsterFor.AAccountccount__c);
        }
        
        for(Account Accountfor : [Select Id, (Select AAccountccount__c, Purchase_Order__c from Dumpsters__r order by createddate desc Limit 1) from Account where Id =:AccountId])
        {
            Dumpsters__c Dumpster = Accountfor.Dumpsters__r;
            DumpsterPurchaseOrder.put(Dumpster.AAccountccount__c, Dumpster.Purchase_Order__c);
        }
        
        system.debug(DumpsterPurchaseOrder);
        
        for(Dumpsters__c DumpsterFor : Database.query('SELECT ' + String.join(new List<String>(Schema.getGlobalDescribe().get('Dumpsters__c').getDescribe().fields.getMap().keySet()), ',') + ' FROM Dumpsters__c where id =: DumpsterId'))
        {
            
            DumpsterFor.status__c = 'Request for Pick-Up';
            DumpsterFor.Trip_Order__c = '30';
            DumpsterFor.Confirmed_Pick_Up_Date__c = DumpsterFor.Drop_Off_Visit_Date__c;
            
            DumpstersUpdate.add(DumpsterFor);
            
            
            Dumpsters__c Dumpsters = new Dumpsters__c();
            Dumpsters.AAccountccount__c = DumpsterFor.AAccountccount__c;
            Dumpsters.Gypsum_Only__c = null;
            //Dumpsters.Comments__c = DumpsterFor.Comments_Helper__c;
            Dumpsters.Concrete_Only__c = null;
            Dumpsters.Contractor_Name_For_Gate__c = DumpsterFor.Contractor_Name_For_Gate__c;
            Dumpsters.Drop_Off_Visit_Date__c = DumpsterFor.Confirmed_Pick_Up_Date__c;
            // Dumpsters.Confirmed_Pick_Up_Date__c = Dumpsters.Drop_Off_Visit_Date__c;
            Dumpsters.Driver__c = DumpsterFor.Pick_Up_Driver__c;
            Dumpsters.Pdf_Parser_Delivery_Address__c = DumpsterFor.Pdf_Parser_Delivery_Address__c;
            Dumpsters.DifferentDriverSameAddress__c = true;
            Dumpsters.Dumpster_Size__c = DumpsterFor.Dumpster_Size__c;
            Dumpsters.Estimated_GP__c = DumpsterFor.Estimated_GP__c;
            //Dumpsters.Invoicing_Comments__c = DumpsterFor.Invoicing_Comments__c;
            Dumpsters.Metal_Only__c = null;
            Dumpsters.Phone_Number_2__c = DumpsterFor.Phone_Number_2__c;
            Dumpsters.Phone_Number_22__c = DumpsterFor.Phone_Number_22__c;
            Dumpsters.Pick_Up_Driver__c = DumpsterFor.Pick_Up_Driver__c;
            Dumpsters.Proposal_Lost_Reason__c = DumpsterFor.Proposal_Lost_Reason__c;
            Dumpsters.Rental__c = DumpsterFor.Rental__c;
            Dumpsters.Status__c = 'Unscheduled';
            Dumpsters.Tonnage_Quantity__c = DumpsterFor.Tonnage_Quantity__c;
            Dumpsters.Wood_Only__c = null;
            Dumpsters.Is_Cloning__c = true;
            try
            {
                if(DumpsterPurchaseOrder.containskey(DumpsterFor.AAccountccount__c))
                {
                    Dumpsters.Purchase_Order__c = DumpsterPurchaseOrder.get(DumpsterFor.AAccountccount__c).substringBefore('.') + '.' + String.valueOf(Integer.valueOf(DumpsterPurchaseOrder.get(DumpsterFor.AAccountccount__c).substringAfter('.'))+1);
                    
                }
            }
            catch(Exception e)
            {
                System.debug('Exception raised due to ' + e);
            }
            DumpstersInsert.add(Dumpsters);
        }
        
        if(DumpstersInsert.size() > 0)
        {
            try
            {
                
                    insert DumpstersInsert;
                
            }
            catch(Exception e)
            {
                System.debug('Exception raised due to ' + e);
            }
        }
        
        if(DumpstersUpdate.size() > 0)
        {
            try
            {
                Update DumpstersUpdate;
            }
            catch(Exception e)
            {
                System.debug('Exception raised due to ' + e);
            }
        }
    }
    
    
    
    /*=====================Ticket 61785===============================
*Method Name     : updateAverageCycleDays
*Description     : update the Average cycle days field in the account when the confirm pickupdate given in the dumpser
====================================================*/
    public void updateAverageCycleDays(Map<id,Dumpsters__c> NewDumpMap){
        set<Id> accIdSet = new set<Id>();
        List<Account> afterUpdateAverageAccountList = new List<Account>();
        
        for(Dumpsters__c dump:NewDumpMap.values()){
            accIdSet.add(dump.AAccountccount__c);
            system.debug('account added');
            }
            
        Double sum = 0;
        Integer count = 0;
        Double Average =0;
        for(Dumpsters__c  Dumpster_For : [select id,Name,Status__c,AAccountccount__c,AAccountccount__r.id,AAccountccount__r.Average_Cycle_Days__c,Dumpster_Days_on_Onsite__c,Drop_Off_Visit_Date__c,Confirmed_Pick_Up_Date__c,CreatedDate from Dumpsters__c WHERE  AAccountccount__c =:accIdSet  and Confirmed_Pick_Up_Date__c!=null and Dumpster_Days_on_Onsite__c !=null AND CreatedDate >= LAST_N_MONTHS:6]){
            system.debug('inside for>>');
            
                sum = Dumpster_For.Dumpster_Days_on_Onsite__c + sum;
                count++;
                system.debug('aveerage cycle days calculated');
                
            
        }
        if(count > 0){
            system.debug('sum values>>' + sum);
            system.debug('count values>>' + count);
            Average = sum / count;
            system.debug(' average vlaue >>>>' + Average);
        }
            system.debug('size >>'+accIdSet.size());
        
        for(Account acc:[select id,Name,Type,Average_Cycle_Days__c,Phone,Haulbrooke_Account__c,Rental_Day_Reminder__c from Account where id =:accIdSet]){
                   
                    acc.Average_Cycle_Days__c = Average;
                   system.debug('acc.Average_Cycle_Days__c >>' + acc.Average_Cycle_Days__c);
                  
                    afterUpdateAverageAccountList.add(acc);
                    system.debug(' account list added >>>>' + acc);
           
            
        }
        if(afterUpdateAverageAccountList.size()>0){
            update afterUpdateAverageAccountList;
            system.debug(' updated account list >>>>' + afterUpdateAverageAccountList);
            
        }
    }
/*=========================================================================================
*Method Name     : Driverlookup
*Description     : Run Before insert,update.
*Ticket no       : 55211
*Arguments       : 
=========================================================================================*/
        //This method is used to updated the driver picklist field based on the driver lookup field values.
    public void Dropoff(List<Dumpsters__c> DumpstersList){
        system.debug('Dumpsters list is >> '+ DumpstersList);
        Set<Resource__c> resourcSet=new Set<Resource__c>();
        Set<Id> driverLookupIdSet = new Set<Id>();
        String DriverName;
        
        for(Dumpsters__c DumpstersFor :DumpstersList)
        {
            driverLookupIdSet.add(DumpstersFor.Drop_of_Driver_Lkp__c);
            system.debug('driver lookup id >> '+ driverLookupIdSet);
        }
        
        for(Resource__c res:[Select id,name,Full_Name__c from Resource__c where id = :driverLookupIdSet])
        {
            
            resourcSet.add(res);
            
        }
        if(resourcSet.size()>0)
        {
            
            for(Resource__c resourceFor : resourcSet
               ){
                DriverName = resourceFor.Full_Name__c;
            }
            
            for(Dumpsters__c dm:DumpstersList)
            {
                    dm.driver__c = DriverName;
            }
           
        }
    }
/*=========================================================================================
*Method Name     : Driverlookup
*Description     : Run Before insert,update.
*Ticket no       : 55211
*Arguments       : 
=========================================================================================*/
        //This method is used to updated the driver picklist field based on the driver lookup field values.
    public void Pickup(List<Dumpsters__c> DumpstersList){
        system.debug('Dumpsters list is >> '+ DumpstersList);
        Set<Resource__c> resourcSet=new Set<Resource__c>();
        Set<Id> driverLookupIdSet = new Set<Id>();
        String DriverName;
        
        for(Dumpsters__c DumpstersFor :DumpstersList)
        {
            driverLookupIdSet.add(DumpstersFor.Pick_Up_Driver_Lkp__c);
            system.debug('driver lookup id >> '+ driverLookupIdSet);
        }
        
        for(Resource__c res:[Select id,name,Full_Name__c from Resource__c where id = :driverLookupIdSet])
        {
            
            resourcSet.add(res);
            
        }
        if(resourcSet.size()>0)
        {
            
            for(Resource__c resourceFor : resourcSet){
                DriverName = resourceFor.Full_Name__c;
            }
            
            for(Dumpsters__c dm:DumpstersList)
            {
                    dm.Pick_Up_Driver__c = DriverName;
            }
           
        }
    }
    /*=========================================================================================
*Method Name     : public static void selfschedule()
*Description     : Schedule the Drivers trip order based on shortest loc wise
*Arguments       : To get a new values from Dumpster object.
===========================================================================================*/   
    /*  
@future(callout=true)
public static void selfschedule(string newmap , string oldmap)
{

}

*/
    
    
    
    
    
    /*==================================18642=======================================================
*Method Name     : public void createnewdumpsterinvoice()
*Description     : Create new dumpster Invoice when we set again the Pickup scheduled.
*Arguments       : To get a new values from Dumpster object.
===========================================================================================*/
    
    /*public void createnewdumpsterinvoice(Map<id,Dumpsters__c> newdummap)
{
system.debug(newdummap);
List<Dumpster_Invoice__c> DumpsterInvoiceInsert = new List<Dumpster_Invoice__c>();

for(Dumpsters__c dumpster : [select id,initial_invoice_count__c,Final_invoice_count__c,Card_Run__c,Prohibited_Items__c,Consolidate_Invoice__c,name,AAccountccount__r.Consolidated_Invoice__c,Status__c,Dumpster_Size__c,Sales_Tax__c,Extra_Rental_Charge_Per_Day__c ,Dumpster_Rental_Price__c ,Per_Ton_Charge__c ,AAccountccount__c,AAccountccount__r.Email_1__c,AAccountccount__r.Email_2__c,AAccountccount__r.Email_3__c,AAccountccount__r.Email_4__c,Initial_Invoice_Subtotal__c,Other_Charges__c,Wait_Charge__c,Final_Invoice_Subtotal__c,Tonnage_Quantity__c,Additional_Tonnage_Quantity__c,Extra_Rental_DaysF__c,Rental__c,Initial_Invoice_Number__c,Final_Invoice_Number__c from Dumpsters__c where id=:newdumMap.keyset()])
{
if(dumpster.Consolidate_Invoice__c == 'Yes')
{
Dumpster_Invoice__c DumpsterInvoice = new Dumpster_Invoice__c();
DumpsterInvoice.Dumpsters__c        = dumpster.id;
//DumpsterInvoice.Description__c      = 'Dumpster Rental';      //17726
DumpsterInvoice.Invoice_Date__c     = System.today();
DumpsterInvoice.Date_Due__c         = System.today();

DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
DumpsterInvoice.Additional_Email__c = dumpster.AAccountccount__r.Email_2__c;
DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;

String Email1 = Label.Invoice_Email_1; 
String Email2 = Label.Invoice_Email_2;

String AccountId =dumpster.AAccountccount__c ;
AccountId= AccountId.substring(0,AccountId.length()-3);

if(Email1.Contains(AccountId ) || Test.isRunningTest())
{
DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
DumpsterInvoice.Additional_Email__c = null;
DumpsterInvoice.Additional_Email2__c = null;
DumpsterInvoice.Additional_Email3__c = null;
}

if(Email2.Contains(AccountId ) || Test.isRunningTest())
{
DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_2__c;
DumpsterInvoice.Additional_Email__c = null; 
DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
}

if(Label.Description_Dumpster_Size.Contains(AccountId ) || Test.isRunningTest())
{
DumpsterInvoice.Description__c      = 'Final Invoice, Additional Ton - ' + dumpster.Dumpster_Size__c;
}
else
{
DumpsterInvoice.Description__c      = 'Dumpster Rental';
}

DumpsterInvoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Consolidated Invoice').getRecordTypeId();
DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
DumpsterInvoice.Other_Charges__c             = Dumpster.Other_Charges__c;
DumpsterInvoice.Wait_Charge__c      = Dumpster.Wait_Charge__c;
DumpsterInvoice.Extra_Rental_Charge_Per_Day__c  = Dumpster.Extra_Rental_Charge_Per_Day__c;
DumpsterInvoice.Final_Invoice_Subtotal__c       = Dumpster.Final_Invoice_Subtotal__c;
DumpsterInvoice.Additional_Tonnage_Quantity__c  = Dumpster.Additional_Tonnage_Quantity__c;
DumpsterInvoice.Extra_Rental_Days__c            = Dumpster.Extra_Rental_DaysF__c;
DumpsterInvoice.Sales_Tax__c                    = Dumpster.Sales_Tax__c; 
DumpsterInvoice.Account__c                      = Dumpster.AAccountccount__c;
DumpsterInvoice.Prohibited_Items__c             = Dumpster.Prohibited_Items__c;
DumpsterInvoice.Dumpster_Rental_price__c     = Dumpster.Dumpster_Rental_price__c;
DumpsterInvoice.Initial_Invoice_Subtotal__c  = Dumpster.Initial_Invoice_Subtotal__c;
DumpsterInvoice.Tonnage_Quantity__c             = Dumpster.Tonnage_Quantity__c;
DumpsterInvoice.Sales_Tax__c                    = Dumpster.Sales_Tax__c;
DumpsterInvoice.Account__c                      = Dumpster.AAccountccount__c;
DumpsterInvoice.Card_Run__c                     = Dumpster.Card_Run__c;
DumpsterInvoiceInsert.add(DumpsterInvoice);
}
else
{
Dumpster_Invoice__c DumpsterInvoice = new Dumpster_Invoice__c();
DumpsterInvoice.Dumpsters__c        = dumpster.id;
//DumpsterInvoice.Description__c      = 'Dumpster Rental';      //17726
DumpsterInvoice.Invoice_Date__c     = System.today();
DumpsterInvoice.Date_Due__c         = System.today();

DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
DumpsterInvoice.Additional_Email__c = dumpster.AAccountccount__r.Email_2__c;
DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;

String Email1 = Label.Invoice_Email_1; 
String Email2 = Label.Invoice_Email_2;

String AccountId =dumpster.AAccountccount__c ;
AccountId= AccountId.substring(0,AccountId.length()-3);

if(Email1.Contains(AccountId ) || Test.isRunningTest())
{
DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_1__c;
DumpsterInvoice.Additional_Email__c = null;
DumpsterInvoice.Additional_Email2__c = null;
DumpsterInvoice.Additional_Email3__c = null;
}

if(Email2.Contains(AccountId ) || Test.isRunningTest())
{
DumpsterInvoice.Customer_Email__c   = dumpster.AAccountccount__r.Email_2__c;
DumpsterInvoice.Additional_Email__c = null; 
DumpsterInvoice.Additional_Email2__c = dumpster.AAccountccount__r.Email_3__c;
DumpsterInvoice.Additional_Email3__c = dumpster.AAccountccount__r.Email_4__c;
}

if(Label.Description_Dumpster_Size.Contains(AccountId ) || Test.isRunningTest())
{
DumpsterInvoice.Description__c      = 'Final Invoice, Additional Ton - ' + dumpster.Dumpster_Size__c;
}
else
{
DumpsterInvoice.Description__c      = 'Dumpster Rental';
}

DumpsterInvoice.RecordtypeId        = Schema.SObjectType.Dumpster_Invoice__c.getRecordTypeInfosByName().get('Final Invoice').getRecordTypeId();
DumpsterInvoice.Per_Ton_Charge__c   = Dumpster.Per_Ton_Charge__c;
DumpsterInvoice.Other_Charges__c             = Dumpster.Other_Charges__c;
DumpsterInvoice.Wait_Charge__c      = Dumpster.Wait_Charge__c;
DumpsterInvoice.Extra_Rental_Charge_Per_Day__c  = Dumpster.Extra_Rental_Charge_Per_Day__c;
DumpsterInvoice.Final_Invoice_Subtotal__c       = Dumpster.Final_Invoice_Subtotal__c;
DumpsterInvoice.Additional_Tonnage_Quantity__c  = Dumpster.Additional_Tonnage_Quantity__c;
DumpsterInvoice.Extra_Rental_Days__c            = Dumpster.Extra_Rental_DaysF__c;
DumpsterInvoice.Sales_Tax__c                    = Dumpster.Sales_Tax__c; 
DumpsterInvoice.Account__c                      = Dumpster.AAccountccount__c;
DumpsterInvoice.Prohibited_Items__c             = Dumpster.Prohibited_Items__c;
DumpsterInvoice.Card_Run__c                     = Dumpster.Card_Run__c;
DumpsterInvoiceInsert.add(DumpsterInvoice);
}
}

if(DumpsterInvoiceInsert.size() > 0)
{
try
{
insert DumpsterInvoiceInsert;
}
catch(Exception e)
{
System.debug('Exception ' + e);
}
}
}*/
    
    /*-----------------------------------------------------------------------------------------
Method Name: SalesTaxUpdate(Map<Id,Dumpsters__c> newdumMap, Map<Id,Dumpsters__c> olddumMap)
Amended    : 10-Dec-2018
-------------------------------------------------------------------------------------------*/
    /*
public void SalesTaxUpdate(Map<id,Dumpsters__c> newdummap,Map<id,Dumpsters__c> olddummap){

Set<String> SalesTaxZipSet = new Set<String>();
Map<id,Dumpsters__c> DumpstersMap = new Map<id,Dumpsters__c>();
Map<String,Decimal> ZipandSalesTaxMap = new Map<String,Decimal>();
List<Dumpsters__c> DumpsterList = new  List<Dumpsters__c>();

for(Dumpsters__c dumpster:newdummap.values()){
if(dumpster.Delivery_Zip__c != olddummap.get(dumpster.id).Delivery_Zip__c ){
DumpstersMap.put(dumpster.id,dumpster);
SalesTaxZipSet.add(String.valueOf(dumpster.Delivery_Zip__c));

}
}

if(SalesTaxZipSet.size()>0){
for(Zip_Code_based_Sales_Tax__c ZipandSalesTax :[select name,Sales_Tax__c from Zip_Code_based_Sales_Tax__c where name=:SalesTaxZipSet]){
ZipandSalesTaxMap.put(ZipandSalesTax.name,ZipandSalesTax.Sales_Tax__c);
}
}

for(Dumpsters__c Dumpster:[select id,name,Status__c,Extra_Rental_Charge_Per_Day__c,Sales_Tax__c,Delivery_Zip__c,Dumpster_Rental_Price__c ,Per_Ton_Charge__c ,AAccountccount__c,AAccountccount__r.Email_1__c,AAccountccount__r.Email_2__c,Initial_Invoice_Subtotal__c,Other_Charges__c,Wait_Charge__c,Final_Invoice_Subtotal__c,Tonnage_Quantity__c,Additional_Tonnage_Quantity__c,Extra_Rental_Days__c from Dumpsters__c where id=:DumpstersMap.keyset()]){

if(ZipandSalesTaxMap.containskey(String.ValueOf(Dumpster.Delivery_Zip__c))){
Dumpster.Sales_Tax__c = ZipandSalesTaxMap.get(String.valueOf(Dumpster.Delivery_Zip__c));
}
else if(Dumpster.Delivery_Zip__c == null){
Dumpster.Sales_Tax__c = 8.25;
}

DumpsterList.add(Dumpster);

}
if(DumpsterList.size()>0){
try{
Update DumpsterList;

}
catch(exception e){

}
}
}


*/
    

/*    public void average_gp(Map<Id,Dumpsters__c> newdumMap,Map<Id,Dumpsters__c> olddumMap)
    {
        List<Dumpsters__c> dump = new List<Dumpsters__c>();
        
    }*/
    
}//class
//average_gp(newdumMap,olddumMap);